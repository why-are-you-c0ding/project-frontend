"use strict";(self.webpackChunksleact_ts_front=self.webpackChunksleact_ts_front||[]).push([[129],{97650:(e,t,n)=>{n.d(t,{YD:()=>s});var r=n(67294);const i=new Map,o=new WeakMap;let a=0;function u(e,t,n={},r){if(void 0===window.IntersectionObserver&&void 0!==r){const i=e.getBoundingClientRect();return t(r,{isIntersecting:r,target:e,intersectionRatio:"number"==typeof n.threshold?n.threshold:0,time:0,boundingClientRect:i,intersectionRect:i,rootBounds:i}),()=>{}}const{id:u,observer:s,elements:c}=function(e){let t=function(e){return Object.keys(e).sort().filter((t=>void 0!==e[t])).map((t=>{return`${t}_${"root"===t?(n=e.root,n?(o.has(n)||(a+=1,o.set(n,a.toString())),o.get(n)):"0"):e[t]}`;var n})).toString()}(e),n=i.get(t);if(!n){const r=new Map;let o;const a=new IntersectionObserver((t=>{t.forEach((t=>{var n;const i=t.isIntersecting&&o.some((e=>t.intersectionRatio>=e));e.trackVisibility&&void 0===t.isVisible&&(t.isVisible=i),null==(n=r.get(t.target))||n.forEach((e=>{e(i,t)}))}))}),e);o=a.thresholds||(Array.isArray(e.threshold)?e.threshold:[e.threshold||0]),n={id:t,observer:a,elements:r},i.set(t,n)}return n}(n);let l=c.get(e)||[];return c.has(e)||c.set(e,l),l.push(t),s.observe(e),function(){l.splice(l.indexOf(t),1),0===l.length&&(c.delete(e),s.unobserve(e)),0===c.size&&(s.disconnect(),i.delete(u))}}function s({threshold:e,delay:t,trackVisibility:n,rootMargin:i,root:o,triggerOnce:a,skip:s,initialInView:c,fallbackInView:l,onChange:f}={}){var v;const[d,h]=r.useState(null),p=r.useRef(),[y,g]=r.useState({inView:!!c,entry:void 0});p.current=f,r.useEffect((()=>{if(s||!d)return;let r=u(d,((e,t)=>{g({inView:e,entry:t}),p.current&&p.current(e,t),t.isIntersecting&&a&&r&&(r(),r=void 0)}),{root:o,rootMargin:i,threshold:e,trackVisibility:n,delay:t},l);return()=>{r&&r()}}),[Array.isArray(e)?e.toString():e,d,o,i,a,s,n,l,t]);const b=null==(v=y.entry)?void 0:v.target;r.useEffect((()=>{d||!b||a||s||g({inView:!!c,entry:void 0})}),[d,b,a,s,c]);const w=[h,y.inView,y.entry];return w.ref=w[0],w.inView=w[1],w.entry=w[2],w}r.Component},44593:(e,t,n)=>{n.d(t,{ZP:()=>w});var r=n(67294),i=n(8100),o=function(){return o=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},o.apply(this,arguments)};var a,u,s=function(){},c=s(),l=Object,f=function(e){return e===c},v=function(e){return"function"==typeof e},d="undefined"==typeof window||"Deno"in window?r.useEffect:r.useLayoutEffect,h=new WeakMap,p=0,y=function(e){var t,n,r=typeof e,i=e&&e.constructor,o=i==Date;if(l(e)!==e||o||i==RegExp)t=o?e.toJSON():"symbol"==r?e.toString():"string"==r?JSON.stringify(e):""+e;else{if(t=h.get(e))return t;if(t=++p+"~",h.set(e,t),i==Array){for(t="@",n=0;n<e.length;n++)t+=y(e[n])+",";h.set(e,t)}if(i==l){t="#";for(var a=l.keys(e).sort();!f(n=a.pop());)f(e[n])||(t+=n+":"+y(e[n])+",");h.set(e,t)}}return t},g=function(e){if(v(e))try{e=e()}catch(t){e=""}var t=[].concat(e);return[e="string"==typeof e?e:(Array.isArray(e)?e.length:e)?y(e):"",t,e?"$swr$"+e:""]},b=function(e){return v(e[1])?[e[0],e[1],e[2]||{}]:[e[0],null,(null===e[1]?e[2]:e[1])||{}]},w=(a=i.ZP,u=function(e){return function(t,n,i){var o=(0,r.useState)({})[1],a=(0,r.useRef)(!1),u=(0,r.useRef)(),s=i.cache,l=i.initialSize,h=void 0===l?1:l,p=i.revalidateAll,y=void 0!==p&&p,b=i.persistSize,w=void 0!==b&&b,k=i.revalidateFirstPage,m=void 0===k||k,S=i.revalidateOnMount,V=void 0!==S&&S,O=null;try{O=function(e){return g(e?e(0,null):null)[0]}(t)}catch(e){}var R=null,$=null;O&&(R="$ctx$"+O,$="$len$"+O);var C=(0,r.useCallback)((function(){var e=s.get($);return f(e)?h:e}),[$,h]),x=(0,r.useRef)(C());d((function(){a.current?O&&s.set($,w?x.current:h):a.current=!0}),[O]);var A=V&&!a.current,E=e(O?"$inf$"+O:null,(function(){return e=void 0,r=void 0,a=function(){var e,r,o,a,c,l,v,d,h,p,b,w;return function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function u(o){return function(u){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,u])}}}(this,(function(k){switch(k.label){case 0:e=s.get(R)||[],r=e[0],o=e[1],a=[],c=C(),l=null,v=0,k.label=1;case 1:return v<c?(d=g(t(v,l)),h=d[0],p=d[1],h?(b=s.get(h),w=y||r||f(b)||m&&!v&&!f(u.current)||A||o&&!f(o[v])&&!i.compare(o[v],b),n&&w?[4,n.apply(void 0,p)]:[3,3]):[3,5]):[3,5];case 2:b=k.sent(),s.set(h,b),k.label=3;case 3:a.push(b),l=b,k.label=4;case 4:return++v,[3,1];case 5:return s.delete(R),[2,a]}}))},new((o=void 0)||(o=Promise))((function(t,n){function i(e){try{s(a.next(e))}catch(e){n(e)}}function u(e){try{s(a.throw(e))}catch(e){n(e)}}function s(e){var n;e.done?t(e.value):(n=e.value,n instanceof o?n:new o((function(e){e(n)}))).then(i,u)}s((a=a.apply(e,r||[])).next())}));var e,r,o,a}),i);d((function(){u.current=E.data}),[E.data]);var I=(0,r.useCallback)((function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=e[0],r=!1!==e[1];if(R){if(r)if(f(n))s.set(R,[!0]);else{var i=u.current;s.set(R,[!1,i])}return e.length?E.mutate(n,r):E.mutate()}}),[R]),M=(0,r.useCallback)((function(e){var n;if($&&(v(e)?n=e(C()):"number"==typeof e&&(n=e),"number"==typeof n))return s.set($,n),x.current=n,o({}),I(function(e){for(var n=[],r=null,i=0;i<e;++i){var o=g(t(i,r))[0],a=o?s.get(o):c;if(f(a))return u.current;n.push(a),r=a}return n}(n))}),[$,C,I]);return{size:C(),setSize:M,mutate:I,get error(){return E.error},get data(){return E.data},get isValidating(){return E.isValidating}}}},function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=b(e),r=n[0],i=n[1],s=n[2],c=(s.use||[]).concat(u);return a(r,i,o(o({},s),{use:c}))})}}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUFJOEMsT0FFWHhDLFdBQ0EsT0FBT04sRUFBSU0sTUFFWHlDLG1CQUNBLE9BQU8vQyxFQUFJK0MsaUJBdk1oQixXQUVILElBREEsSUFBSS9FLEVBQU8sR0FDRjBFLEVBQUssRUFBR0EsRUFBSzVHLFVBQVUxQixPQUFRc0ksSUFDcEMxRSxFQUFLMEUsR0FBTTVHLFVBQVU0RyxHQUV6QixJQUFJN0QsRUFBS1gsRUFBVUYsR0FBT3JGLEVBQU1rRyxFQUFHLEdBQUlSLEVBQUtRLEVBQUcsR0FBSVAsRUFBU08sRUFBRyxHQUMzRG1FLEdBQVExRSxFQUFPMkUsS0FBTyxJQUFJaEYsT0FBTzNCLEdBQ3JDLE9BQU9ELEVBQU8xRCxFQUFLMEYsRUFBSTdDLEVBQVNBLEVBQVMsR0FBSThDLEdBQVMsQ0FBRTJFLElBQUtEIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vc2xlYWN0LXRzLWZyb250Ly4vbm9kZV9tb2R1bGVzL3JlYWN0LWludGVyc2VjdGlvbi1vYnNlcnZlci9yZWFjdC1pbnRlcnNlY3Rpb24tb2JzZXJ2ZXIubW9kZXJuLm1qcyIsIndlYnBhY2s6Ly9zbGVhY3QtdHMtZnJvbnQvLi9ub2RlX21vZHVsZXMvc3dyL2luZmluaXRlL2Rpc3QvaW5kZXgubWpzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAqIGFzIFJlYWN0IGZyb20gJ3JlYWN0JztcblxuZnVuY3Rpb24gX2V4dGVuZHMoKSB7XG4gIF9leHRlbmRzID0gT2JqZWN0LmFzc2lnbiB8fCBmdW5jdGlvbiAodGFyZ2V0KSB7XG4gICAgZm9yICh2YXIgaSA9IDE7IGkgPCBhcmd1bWVudHMubGVuZ3RoOyBpKyspIHtcbiAgICAgIHZhciBzb3VyY2UgPSBhcmd1bWVudHNbaV07XG5cbiAgICAgIGZvciAodmFyIGtleSBpbiBzb3VyY2UpIHtcbiAgICAgICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChzb3VyY2UsIGtleSkpIHtcbiAgICAgICAgICB0YXJnZXRba2V5XSA9IHNvdXJjZVtrZXldO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIHRhcmdldDtcbiAgfTtcblxuICByZXR1cm4gX2V4dGVuZHMuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbn1cblxuZnVuY3Rpb24gX29iamVjdFdpdGhvdXRQcm9wZXJ0aWVzTG9vc2Uoc291cmNlLCBleGNsdWRlZCkge1xuICBpZiAoc291cmNlID09IG51bGwpIHJldHVybiB7fTtcbiAgdmFyIHRhcmdldCA9IHt9O1xuICB2YXIgc291cmNlS2V5cyA9IE9iamVjdC5rZXlzKHNvdXJjZSk7XG4gIHZhciBrZXksIGk7XG5cbiAgZm9yIChpID0gMDsgaSA8IHNvdXJjZUtleXMubGVuZ3RoOyBpKyspIHtcbiAgICBrZXkgPSBzb3VyY2VLZXlzW2ldO1xuICAgIGlmIChleGNsdWRlZC5pbmRleE9mKGtleSkgPj0gMCkgY29udGludWU7XG4gICAgdGFyZ2V0W2tleV0gPSBzb3VyY2Vba2V5XTtcbiAgfVxuXG4gIHJldHVybiB0YXJnZXQ7XG59XG5cbmNvbnN0IG9ic2VydmVyTWFwID0gbmV3IE1hcCgpO1xuY29uc3QgUm9vdElkcyA9IG5ldyBXZWFrTWFwKCk7XG5sZXQgcm9vdElkID0gMDtcbmxldCB1bnN1cHBvcnRlZFZhbHVlID0gdW5kZWZpbmVkO1xuLyoqXHJcbiAqIFdoYXQgc2hvdWxkIGJlIHRoZSBkZWZhdWx0IGJlaGF2aW9yIGlmIHRoZSBJbnRlcnNlY3Rpb25PYnNlcnZlciBpcyB1bnN1cHBvcnRlZD9cclxuICogSWRlYWxseSB0aGUgcG9seWZpbGwgaGFzIGJlZW4gbG9hZGVkLCB5b3UgY2FuIGhhdmUgdGhlIGZvbGxvd2luZyBoYXBwZW46XHJcbiAqIC0gYHVuZGVmaW5lZGA6IFRocm93IGFuIGVycm9yXHJcbiAqIC0gYHRydWVgIG9yIGBmYWxzZWA6IFNldCB0aGUgYGluVmlld2AgdmFsdWUgdG8gdGhpcyByZWdhcmRsZXNzIG9mIGludGVyc2VjdGlvbiBzdGF0ZVxyXG4gKiAqKi9cblxuZnVuY3Rpb24gZGVmYXVsdEZhbGxiYWNrSW5WaWV3KGluVmlldykge1xuICB1bnN1cHBvcnRlZFZhbHVlID0gaW5WaWV3O1xufVxuLyoqXHJcbiAqIEdlbmVyYXRlIGEgdW5pcXVlIElEIGZvciB0aGUgcm9vdCBlbGVtZW50XHJcbiAqIEBwYXJhbSByb290XHJcbiAqL1xuXG5mdW5jdGlvbiBnZXRSb290SWQocm9vdCkge1xuICBpZiAoIXJvb3QpIHJldHVybiAnMCc7XG4gIGlmIChSb290SWRzLmhhcyhyb290KSkgcmV0dXJuIFJvb3RJZHMuZ2V0KHJvb3QpO1xuICByb290SWQgKz0gMTtcbiAgUm9vdElkcy5zZXQocm9vdCwgcm9vdElkLnRvU3RyaW5nKCkpO1xuICByZXR1cm4gUm9vdElkcy5nZXQocm9vdCk7XG59XG4vKipcclxuICogQ29udmVydCB0aGUgb3B0aW9ucyB0byBhIHN0cmluZyBJZCwgYmFzZWQgb24gdGhlIHZhbHVlcy5cclxuICogRW5zdXJlcyB3ZSBjYW4gcmV1c2UgdGhlIHNhbWUgb2JzZXJ2ZXIgd2hlbiBvYnNlcnZpbmcgZWxlbWVudHMgd2l0aCB0aGUgc2FtZSBvcHRpb25zLlxyXG4gKiBAcGFyYW0gb3B0aW9uc1xyXG4gKi9cblxuXG5mdW5jdGlvbiBvcHRpb25zVG9JZChvcHRpb25zKSB7XG4gIHJldHVybiBPYmplY3Qua2V5cyhvcHRpb25zKS5zb3J0KCkuZmlsdGVyKGtleSA9PiBvcHRpb25zW2tleV0gIT09IHVuZGVmaW5lZCkubWFwKGtleSA9PiB7XG4gICAgcmV0dXJuIGAke2tleX1fJHtrZXkgPT09ICdyb290JyA/IGdldFJvb3RJZChvcHRpb25zLnJvb3QpIDogb3B0aW9uc1trZXldfWA7XG4gIH0pLnRvU3RyaW5nKCk7XG59XG5cbmZ1bmN0aW9uIGNyZWF0ZU9ic2VydmVyKG9wdGlvbnMpIHtcbiAgLy8gQ3JlYXRlIGEgdW5pcXVlIElEIGZvciB0aGlzIG9ic2VydmVyIGluc3RhbmNlLCBiYXNlZCBvbiB0aGUgcm9vdCwgcm9vdCBtYXJnaW4gYW5kIHRocmVzaG9sZC5cbiAgbGV0IGlkID0gb3B0aW9uc1RvSWQob3B0aW9ucyk7XG4gIGxldCBpbnN0YW5jZSA9IG9ic2VydmVyTWFwLmdldChpZCk7XG5cbiAgaWYgKCFpbnN0YW5jZSkge1xuICAgIC8vIENyZWF0ZSBhIG1hcCBvZiBlbGVtZW50cyB0aGlzIG9ic2VydmVyIGlzIGdvaW5nIHRvIG9ic2VydmUuIEVhY2ggZWxlbWVudCBoYXMgYSBsaXN0IG9mIGNhbGxiYWNrcyB0aGF0IHNob3VsZCBiZSB0cmlnZ2VyZWQsIG9uY2UgaXQgY29tZXMgaW50byB2aWV3LlxuICAgIGNvbnN0IGVsZW1lbnRzID0gbmV3IE1hcCgpO1xuICAgIGxldCB0aHJlc2hvbGRzO1xuICAgIGNvbnN0IG9ic2VydmVyID0gbmV3IEludGVyc2VjdGlvbk9ic2VydmVyKGVudHJpZXMgPT4ge1xuICAgICAgZW50cmllcy5mb3JFYWNoKGVudHJ5ID0+IHtcbiAgICAgICAgdmFyIF9lbGVtZW50cyRnZXQ7XG5cbiAgICAgICAgLy8gV2hpbGUgaXQgd291bGQgYmUgbmljZSBpZiB5b3UgY291bGQganVzdCBsb29rIGF0IGlzSW50ZXJzZWN0aW5nIHRvIGRldGVybWluZSBpZiB0aGUgY29tcG9uZW50IGlzIGluc2lkZSB0aGUgdmlld3BvcnQsIGJyb3dzZXJzIGNhbid0IGFncmVlIG9uIGhvdyB0byB1c2UgaXQuXG4gICAgICAgIC8vIC1GaXJlZm94IGlnbm9yZXMgYHRocmVzaG9sZGAgd2hlbiBjb25zaWRlcmluZyBgaXNJbnRlcnNlY3RpbmdgLCBzbyBpdCB3aWxsIG5ldmVyIGJlIGZhbHNlIGFnYWluIGlmIGB0aHJlc2hvbGRgIGlzID4gMFxuICAgICAgICBjb25zdCBpblZpZXcgPSBlbnRyeS5pc0ludGVyc2VjdGluZyAmJiB0aHJlc2hvbGRzLnNvbWUodGhyZXNob2xkID0+IGVudHJ5LmludGVyc2VjdGlvblJhdGlvID49IHRocmVzaG9sZCk7IC8vIEB0cy1pZ25vcmUgc3VwcG9ydCBJbnRlcnNlY3Rpb25PYnNlcnZlciB2MlxuXG4gICAgICAgIGlmIChvcHRpb25zLnRyYWNrVmlzaWJpbGl0eSAmJiB0eXBlb2YgZW50cnkuaXNWaXNpYmxlID09PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgIC8vIFRoZSBicm93c2VyIGRvZXNuJ3Qgc3VwcG9ydCBJbnRlcnNlY3Rpb24gT2JzZXJ2ZXIgdjIsIGZhbGxpbmcgYmFjayB0byB2MSBiZWhhdmlvci5cbiAgICAgICAgICAvLyBAdHMtaWdub3JlXG4gICAgICAgICAgZW50cnkuaXNWaXNpYmxlID0gaW5WaWV3O1xuICAgICAgICB9XG5cbiAgICAgICAgKF9lbGVtZW50cyRnZXQgPSBlbGVtZW50cy5nZXQoZW50cnkudGFyZ2V0KSkgPT0gbnVsbCA/IHZvaWQgMCA6IF9lbGVtZW50cyRnZXQuZm9yRWFjaChjYWxsYmFjayA9PiB7XG4gICAgICAgICAgY2FsbGJhY2soaW5WaWV3LCBlbnRyeSk7XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgfSwgb3B0aW9ucyk7IC8vIEVuc3VyZSB3ZSBoYXZlIGEgdmFsaWQgdGhyZXNob2xkcyBhcnJheS4gSWYgbm90LCB1c2UgdGhlIHRocmVzaG9sZCBmcm9tIHRoZSBvcHRpb25zXG5cbiAgICB0aHJlc2hvbGRzID0gb2JzZXJ2ZXIudGhyZXNob2xkcyB8fCAoQXJyYXkuaXNBcnJheShvcHRpb25zLnRocmVzaG9sZCkgPyBvcHRpb25zLnRocmVzaG9sZCA6IFtvcHRpb25zLnRocmVzaG9sZCB8fCAwXSk7XG4gICAgaW5zdGFuY2UgPSB7XG4gICAgICBpZCxcbiAgICAgIG9ic2VydmVyLFxuICAgICAgZWxlbWVudHNcbiAgICB9O1xuICAgIG9ic2VydmVyTWFwLnNldChpZCwgaW5zdGFuY2UpO1xuICB9XG5cbiAgcmV0dXJuIGluc3RhbmNlO1xufVxuLyoqXHJcbiAqIEBwYXJhbSBlbGVtZW50IC0gRE9NIEVsZW1lbnQgdG8gb2JzZXJ2ZVxyXG4gKiBAcGFyYW0gY2FsbGJhY2sgLSBDYWxsYmFjayBmdW5jdGlvbiB0byB0cmlnZ2VyIHdoZW4gaW50ZXJzZWN0aW9uIHN0YXR1cyBjaGFuZ2VzXHJcbiAqIEBwYXJhbSBvcHRpb25zIC0gSW50ZXJzZWN0aW9uIE9ic2VydmVyIG9wdGlvbnNcclxuICogQHBhcmFtIGZhbGxiYWNrSW5WaWV3IC0gRmFsbGJhY2sgaW5WaWV3IHZhbHVlLlxyXG4gKiBAcmV0dXJuIEZ1bmN0aW9uIC0gQ2xlYW51cCBmdW5jdGlvbiB0aGF0IHNob3VsZCBiZSB0cmlnZ2VyZWQgdG8gdW5yZWdpc3RlciB0aGUgb2JzZXJ2ZXJcclxuICovXG5cblxuZnVuY3Rpb24gb2JzZXJ2ZShlbGVtZW50LCBjYWxsYmFjaywgb3B0aW9ucyA9IHt9LCBmYWxsYmFja0luVmlldyA9IHVuc3VwcG9ydGVkVmFsdWUpIHtcbiAgaWYgKHR5cGVvZiB3aW5kb3cuSW50ZXJzZWN0aW9uT2JzZXJ2ZXIgPT09ICd1bmRlZmluZWQnICYmIGZhbGxiYWNrSW5WaWV3ICE9PSB1bmRlZmluZWQpIHtcbiAgICBjb25zdCBib3VuZHMgPSBlbGVtZW50LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuICAgIGNhbGxiYWNrKGZhbGxiYWNrSW5WaWV3LCB7XG4gICAgICBpc0ludGVyc2VjdGluZzogZmFsbGJhY2tJblZpZXcsXG4gICAgICB0YXJnZXQ6IGVsZW1lbnQsXG4gICAgICBpbnRlcnNlY3Rpb25SYXRpbzogdHlwZW9mIG9wdGlvbnMudGhyZXNob2xkID09PSAnbnVtYmVyJyA/IG9wdGlvbnMudGhyZXNob2xkIDogMCxcbiAgICAgIHRpbWU6IDAsXG4gICAgICBib3VuZGluZ0NsaWVudFJlY3Q6IGJvdW5kcyxcbiAgICAgIGludGVyc2VjdGlvblJlY3Q6IGJvdW5kcyxcbiAgICAgIHJvb3RCb3VuZHM6IGJvdW5kc1xuICAgIH0pO1xuICAgIHJldHVybiAoKSA9PiB7Ly8gTm90aGluZyB0byBjbGVhbnVwXG4gICAgfTtcbiAgfSAvLyBBbiBvYnNlcnZlciB3aXRoIHRoZSBzYW1lIG9wdGlvbnMgY2FuIGJlIHJldXNlZCwgc28gbGV0cyB1c2UgdGhpcyBmYWN0XG5cblxuICBjb25zdCB7XG4gICAgaWQsXG4gICAgb2JzZXJ2ZXIsXG4gICAgZWxlbWVudHNcbiAgfSA9IGNyZWF0ZU9ic2VydmVyKG9wdGlvbnMpOyAvLyBSZWdpc3RlciB0aGUgY2FsbGJhY2sgbGlzdGVuZXIgZm9yIHRoaXMgZWxlbWVudFxuXG4gIGxldCBjYWxsYmFja3MgPSBlbGVtZW50cy5nZXQoZWxlbWVudCkgfHwgW107XG5cbiAgaWYgKCFlbGVtZW50cy5oYXMoZWxlbWVudCkpIHtcbiAgICBlbGVtZW50cy5zZXQoZWxlbWVudCwgY2FsbGJhY2tzKTtcbiAgfVxuXG4gIGNhbGxiYWNrcy5wdXNoKGNhbGxiYWNrKTtcbiAgb2JzZXJ2ZXIub2JzZXJ2ZShlbGVtZW50KTtcbiAgcmV0dXJuIGZ1bmN0aW9uIHVub2JzZXJ2ZSgpIHtcbiAgICAvLyBSZW1vdmUgdGhlIGNhbGxiYWNrIGZyb20gdGhlIGNhbGxiYWNrIGxpc3RcbiAgICBjYWxsYmFja3Muc3BsaWNlKGNhbGxiYWNrcy5pbmRleE9mKGNhbGxiYWNrKSwgMSk7XG5cbiAgICBpZiAoY2FsbGJhY2tzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgLy8gTm8gbW9yZSBjYWxsYmFjayBleGlzdHMgZm9yIGVsZW1lbnQsIHNvIGRlc3Ryb3kgaXRcbiAgICAgIGVsZW1lbnRzLmRlbGV0ZShlbGVtZW50KTtcbiAgICAgIG9ic2VydmVyLnVub2JzZXJ2ZShlbGVtZW50KTtcbiAgICB9XG5cbiAgICBpZiAoZWxlbWVudHMuc2l6ZSA9PT0gMCkge1xuICAgICAgLy8gTm8gbW9yZSBlbGVtZW50cyBhcmUgYmVpbmcgb2JzZXJ2ZXIgYnkgdGhpcyBpbnN0YW5jZSwgc28gZGVzdHJveSBpdFxuICAgICAgb2JzZXJ2ZXIuZGlzY29ubmVjdCgpO1xuICAgICAgb2JzZXJ2ZXJNYXAuZGVsZXRlKGlkKTtcbiAgICB9XG4gIH07XG59XG5cbmNvbnN0IF9leGNsdWRlZCA9IFtcImNoaWxkcmVuXCIsIFwiYXNcIiwgXCJ0cmlnZ2VyT25jZVwiLCBcInRocmVzaG9sZFwiLCBcInJvb3RcIiwgXCJyb290TWFyZ2luXCIsIFwib25DaGFuZ2VcIiwgXCJza2lwXCIsIFwidHJhY2tWaXNpYmlsaXR5XCIsIFwiZGVsYXlcIiwgXCJpbml0aWFsSW5WaWV3XCIsIFwiZmFsbGJhY2tJblZpZXdcIl07XG5cbmZ1bmN0aW9uIGlzUGxhaW5DaGlsZHJlbihwcm9wcykge1xuICByZXR1cm4gdHlwZW9mIHByb3BzLmNoaWxkcmVuICE9PSAnZnVuY3Rpb24nO1xufVxuLyoqXHJcbiAjIyBSZW5kZXIgcHJvcHNcclxuXG4gVG8gdXNlIHRoZSBgPEluVmlldz5gIGNvbXBvbmVudCwgeW91IHBhc3MgaXQgYSBmdW5jdGlvbi4gSXQgd2lsbCBiZSBjYWxsZWRcclxuIHdoZW5ldmVyIHRoZSBzdGF0ZSBjaGFuZ2VzLCB3aXRoIHRoZSBuZXcgdmFsdWUgb2YgYGluVmlld2AuIEluIGFkZGl0aW9uIHRvIHRoZVxyXG4gYGluVmlld2AgcHJvcCwgY2hpbGRyZW4gYWxzbyByZWNlaXZlIGEgYHJlZmAgdGhhdCBzaG91bGQgYmUgc2V0IG9uIHRoZVxyXG4gY29udGFpbmluZyBET00gZWxlbWVudC4gVGhpcyBpcyB0aGUgZWxlbWVudCB0aGF0IHRoZSBJbnRlcnNlY3Rpb25PYnNlcnZlciB3aWxsXHJcbiBtb25pdG9yLlxyXG5cbiBJZiB5b3UgbmVlZCBpdCwgeW91IGNhbiBhbHNvIGFjY2VzcyB0aGVcclxuIFtgSW50ZXJzZWN0aW9uT2JzZXJ2ZXJFbnRyeWBdKGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuLVVTL2RvY3MvV2ViL0FQSS9JbnRlcnNlY3Rpb25PYnNlcnZlckVudHJ5KVxyXG4gb24gYGVudHJ5YCwgZ2l2aW5nIHlvdSBhY2Nlc3MgdG8gYWxsIHRoZSBkZXRhaWxzIGFib3V0IHRoZSBjdXJyZW50IGludGVyc2VjdGlvblxyXG4gc3RhdGUuXHJcblxuIGBgYGpzeFxyXG4gaW1wb3J0IHsgSW5WaWV3IH0gZnJvbSAncmVhY3QtaW50ZXJzZWN0aW9uLW9ic2VydmVyJztcclxuXG4gY29uc3QgQ29tcG9uZW50ID0gKCkgPT4gKFxyXG4gPEluVmlldz5cclxuIHsoeyBpblZpZXcsIHJlZiwgZW50cnkgfSkgPT4gKFxyXG4gICAgICA8ZGl2IHJlZj17cmVmfT5cclxuICAgICAgICA8aDI+e2BIZWFkZXIgaW5zaWRlIHZpZXdwb3J0ICR7aW5WaWV3fS5gfTwvaDI+XHJcbiAgICAgIDwvZGl2PlxyXG4gICAgKX1cclxuIDwvSW5WaWV3PlxyXG4gKTtcclxuXG4gZXhwb3J0IGRlZmF1bHQgQ29tcG9uZW50O1xyXG4gYGBgXHJcblxuICMjIFBsYWluIGNoaWxkcmVuXHJcblxuIFlvdSBjYW4gcGFzcyBhbnkgZWxlbWVudCB0byB0aGUgYDxJblZpZXcgLz5gLCBhbmQgaXQgd2lsbCBoYW5kbGUgY3JlYXRpbmcgdGhlXHJcbiB3cmFwcGluZyBET00gZWxlbWVudC4gQWRkIGEgaGFuZGxlciB0byB0aGUgYG9uQ2hhbmdlYCBtZXRob2QsIGFuZCBjb250cm9sIHRoZVxyXG4gc3RhdGUgaW4geW91ciBvd24gY29tcG9uZW50LiBBbnkgZXh0cmEgcHJvcHMgeW91IGFkZCB0byBgPEluVmlldz5gIHdpbGwgYmVcclxuIHBhc3NlZCB0byB0aGUgSFRNTCBlbGVtZW50LCBhbGxvd2luZyB5b3Ugc2V0IHRoZSBgY2xhc3NOYW1lYCwgYHN0eWxlYCwgZXRjLlxyXG5cbiBgYGBqc3hcclxuIGltcG9ydCB7IEluVmlldyB9IGZyb20gJ3JlYWN0LWludGVyc2VjdGlvbi1vYnNlcnZlcic7XHJcblxuIGNvbnN0IENvbXBvbmVudCA9ICgpID0+IChcclxuIDxJblZpZXcgYXM9XCJkaXZcIiBvbkNoYW5nZT17KGluVmlldywgZW50cnkpID0+IGNvbnNvbGUubG9nKCdJbnZpZXc6JywgaW5WaWV3KX0+XHJcbiA8aDI+UGxhaW4gY2hpbGRyZW4gYXJlIGFsd2F5cyByZW5kZXJlZC4gVXNlIG9uQ2hhbmdlIHRvIG1vbml0b3Igc3RhdGUuPC9oMj5cclxuIDwvSW5WaWV3PlxyXG4gKTtcclxuXG4gZXhwb3J0IGRlZmF1bHQgQ29tcG9uZW50O1xyXG4gYGBgXHJcbiAqL1xuXG5cbmNsYXNzIEluVmlldyBleHRlbmRzIFJlYWN0LkNvbXBvbmVudCB7XG4gIGNvbnN0cnVjdG9yKHByb3BzKSB7XG4gICAgc3VwZXIocHJvcHMpO1xuICAgIHRoaXMubm9kZSA9IG51bGw7XG4gICAgdGhpcy5fdW5vYnNlcnZlQ2IgPSBudWxsO1xuXG4gICAgdGhpcy5oYW5kbGVOb2RlID0gbm9kZSA9PiB7XG4gICAgICBpZiAodGhpcy5ub2RlKSB7XG4gICAgICAgIC8vIENsZWFyIHRoZSBvbGQgb2JzZXJ2ZXIsIGJlZm9yZSB3ZSBzdGFydCBvYnNlcnZpbmcgYSBuZXcgZWxlbWVudFxuICAgICAgICB0aGlzLnVub2JzZXJ2ZSgpO1xuXG4gICAgICAgIGlmICghbm9kZSAmJiAhdGhpcy5wcm9wcy50cmlnZ2VyT25jZSAmJiAhdGhpcy5wcm9wcy5za2lwKSB7XG4gICAgICAgICAgLy8gUmVzZXQgdGhlIHN0YXRlIGlmIHdlIGdldCBhIG5ldyBub2RlLCBhbmQgd2UgYXJlbid0IGlnbm9yaW5nIHVwZGF0ZXNcbiAgICAgICAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgICAgICAgIGluVmlldzogISF0aGlzLnByb3BzLmluaXRpYWxJblZpZXcsXG4gICAgICAgICAgICBlbnRyeTogdW5kZWZpbmVkXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgdGhpcy5ub2RlID0gbm9kZSA/IG5vZGUgOiBudWxsO1xuICAgICAgdGhpcy5vYnNlcnZlTm9kZSgpO1xuICAgIH07XG5cbiAgICB0aGlzLmhhbmRsZUNoYW5nZSA9IChpblZpZXcsIGVudHJ5KSA9PiB7XG4gICAgICBpZiAoaW5WaWV3ICYmIHRoaXMucHJvcHMudHJpZ2dlck9uY2UpIHtcbiAgICAgICAgLy8gSWYgYHRyaWdnZXJPbmNlYCBpcyB0cnVlLCB3ZSBzaG91bGQgc3RvcCBvYnNlcnZpbmcgdGhlIGVsZW1lbnQuXG4gICAgICAgIHRoaXMudW5vYnNlcnZlKCk7XG4gICAgICB9XG5cbiAgICAgIGlmICghaXNQbGFpbkNoaWxkcmVuKHRoaXMucHJvcHMpKSB7XG4gICAgICAgIC8vIFN0b3JlIHRoZSBjdXJyZW50IFN0YXRlLCBzbyB3ZSBjYW4gcGFzcyBpdCB0byB0aGUgY2hpbGRyZW4gaW4gdGhlIG5leHQgcmVuZGVyIHVwZGF0ZVxuICAgICAgICAvLyBUaGVyZSdzIG5vIHJlYXNvbiB0byB1cGRhdGUgdGhlIHN0YXRlIGZvciBwbGFpbiBjaGlsZHJlbiwgc2luY2UgaXQncyBub3QgdXNlZCBpbiB0aGUgcmVuZGVyaW5nLlxuICAgICAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgICAgICBpblZpZXcsXG4gICAgICAgICAgZW50cnlcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIGlmICh0aGlzLnByb3BzLm9uQ2hhbmdlKSB7XG4gICAgICAgIC8vIElmIHRoZSB1c2VyIGlzIGFjdGl2ZWx5IGxpc3RlbmluZyBmb3Igb25DaGFuZ2UsIGFsd2F5cyB0cmlnZ2VyIGl0XG4gICAgICAgIHRoaXMucHJvcHMub25DaGFuZ2UoaW5WaWV3LCBlbnRyeSk7XG4gICAgICB9XG4gICAgfTtcblxuICAgIHRoaXMuc3RhdGUgPSB7XG4gICAgICBpblZpZXc6ICEhcHJvcHMuaW5pdGlhbEluVmlldyxcbiAgICAgIGVudHJ5OiB1bmRlZmluZWRcbiAgICB9O1xuICB9XG5cbiAgY29tcG9uZW50RGlkVXBkYXRlKHByZXZQcm9wcykge1xuICAgIC8vIElmIGEgSW50ZXJzZWN0aW9uT2JzZXJ2ZXIgb3B0aW9uIGNoYW5nZWQsIHJlaW5pdCB0aGUgb2JzZXJ2ZXJcbiAgICBpZiAocHJldlByb3BzLnJvb3RNYXJnaW4gIT09IHRoaXMucHJvcHMucm9vdE1hcmdpbiB8fCBwcmV2UHJvcHMucm9vdCAhPT0gdGhpcy5wcm9wcy5yb290IHx8IHByZXZQcm9wcy50aHJlc2hvbGQgIT09IHRoaXMucHJvcHMudGhyZXNob2xkIHx8IHByZXZQcm9wcy5za2lwICE9PSB0aGlzLnByb3BzLnNraXAgfHwgcHJldlByb3BzLnRyYWNrVmlzaWJpbGl0eSAhPT0gdGhpcy5wcm9wcy50cmFja1Zpc2liaWxpdHkgfHwgcHJldlByb3BzLmRlbGF5ICE9PSB0aGlzLnByb3BzLmRlbGF5KSB7XG4gICAgICB0aGlzLnVub2JzZXJ2ZSgpO1xuICAgICAgdGhpcy5vYnNlcnZlTm9kZSgpO1xuICAgIH1cbiAgfVxuXG4gIGNvbXBvbmVudFdpbGxVbm1vdW50KCkge1xuICAgIHRoaXMudW5vYnNlcnZlKCk7XG4gICAgdGhpcy5ub2RlID0gbnVsbDtcbiAgfVxuXG4gIG9ic2VydmVOb2RlKCkge1xuICAgIGlmICghdGhpcy5ub2RlIHx8IHRoaXMucHJvcHMuc2tpcCkgcmV0dXJuO1xuICAgIGNvbnN0IHtcbiAgICAgIHRocmVzaG9sZCxcbiAgICAgIHJvb3QsXG4gICAgICByb290TWFyZ2luLFxuICAgICAgdHJhY2tWaXNpYmlsaXR5LFxuICAgICAgZGVsYXksXG4gICAgICBmYWxsYmFja0luVmlld1xuICAgIH0gPSB0aGlzLnByb3BzO1xuICAgIHRoaXMuX3Vub2JzZXJ2ZUNiID0gb2JzZXJ2ZSh0aGlzLm5vZGUsIHRoaXMuaGFuZGxlQ2hhbmdlLCB7XG4gICAgICB0aHJlc2hvbGQsXG4gICAgICByb290LFxuICAgICAgcm9vdE1hcmdpbixcbiAgICAgIC8vIEB0cy1pZ25vcmVcbiAgICAgIHRyYWNrVmlzaWJpbGl0eSxcbiAgICAgIC8vIEB0cy1pZ25vcmVcbiAgICAgIGRlbGF5XG4gICAgfSwgZmFsbGJhY2tJblZpZXcpO1xuICB9XG5cbiAgdW5vYnNlcnZlKCkge1xuICAgIGlmICh0aGlzLl91bm9ic2VydmVDYikge1xuICAgICAgdGhpcy5fdW5vYnNlcnZlQ2IoKTtcblxuICAgICAgdGhpcy5fdW5vYnNlcnZlQ2IgPSBudWxsO1xuICAgIH1cbiAgfVxuXG4gIHJlbmRlcigpIHtcbiAgICBpZiAoIWlzUGxhaW5DaGlsZHJlbih0aGlzLnByb3BzKSkge1xuICAgICAgY29uc3Qge1xuICAgICAgICBpblZpZXcsXG4gICAgICAgIGVudHJ5XG4gICAgICB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgIHJldHVybiB0aGlzLnByb3BzLmNoaWxkcmVuKHtcbiAgICAgICAgaW5WaWV3LFxuICAgICAgICBlbnRyeSxcbiAgICAgICAgcmVmOiB0aGlzLmhhbmRsZU5vZGVcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIGNvbnN0IF90aGlzJHByb3BzID0gdGhpcy5wcm9wcyxcbiAgICAgICAgICB7XG4gICAgICBjaGlsZHJlbixcbiAgICAgIGFzXG4gICAgfSA9IF90aGlzJHByb3BzLFxuICAgICAgICAgIHByb3BzID0gX29iamVjdFdpdGhvdXRQcm9wZXJ0aWVzTG9vc2UoX3RoaXMkcHJvcHMsIF9leGNsdWRlZCk7XG5cbiAgICByZXR1cm4gUmVhY3QuY3JlYXRlRWxlbWVudChhcyB8fCAnZGl2JywgX2V4dGVuZHMoe1xuICAgICAgcmVmOiB0aGlzLmhhbmRsZU5vZGVcbiAgICB9LCBwcm9wcyksIGNoaWxkcmVuKTtcbiAgfVxuXG59XG5cbi8qKlxyXG4gKiBSZWFjdCBIb29rcyBtYWtlIGl0IGVhc3kgdG8gbW9uaXRvciB0aGUgYGluVmlld2Agc3RhdGUgb2YgeW91ciBjb21wb25lbnRzLiBDYWxsXHJcbiAqIHRoZSBgdXNlSW5WaWV3YCBob29rIHdpdGggdGhlIChvcHRpb25hbCkgW29wdGlvbnNdKCNvcHRpb25zKSB5b3UgbmVlZC4gSXQgd2lsbFxyXG4gKiByZXR1cm4gYW4gYXJyYXkgY29udGFpbmluZyBhIGByZWZgLCB0aGUgYGluVmlld2Agc3RhdHVzIGFuZCB0aGUgY3VycmVudFxyXG4gKiBbYGVudHJ5YF0oaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4tVVMvZG9jcy9XZWIvQVBJL0ludGVyc2VjdGlvbk9ic2VydmVyRW50cnkpLlxyXG4gKiBBc3NpZ24gdGhlIGByZWZgIHRvIHRoZSBET00gZWxlbWVudCB5b3Ugd2FudCB0byBtb25pdG9yLCBhbmQgdGhlIGhvb2sgd2lsbFxyXG4gKiByZXBvcnQgdGhlIHN0YXR1cy5cclxuICpcclxuICogQGV4YW1wbGVcclxuICogYGBganN4XHJcbiAqIGltcG9ydCBSZWFjdCBmcm9tICdyZWFjdCc7XHJcbiAqIGltcG9ydCB7IHVzZUluVmlldyB9IGZyb20gJ3JlYWN0LWludGVyc2VjdGlvbi1vYnNlcnZlcic7XHJcbiAqXHJcbiAqIGNvbnN0IENvbXBvbmVudCA9ICgpID0+IHtcclxuICogICBjb25zdCB7IHJlZiwgaW5WaWV3LCBlbnRyeSB9ID0gdXNlSW5WaWV3KHtcclxuICogICAgICAgdGhyZXNob2xkOiAwLFxyXG4gKiAgIH0pO1xyXG4gKlxyXG4gKiAgIHJldHVybiAoXHJcbiAqICAgICA8ZGl2IHJlZj17cmVmfT5cclxuICogICAgICAgPGgyPntgSGVhZGVyIGluc2lkZSB2aWV3cG9ydCAke2luVmlld30uYH08L2gyPlxyXG4gKiAgICAgPC9kaXY+XHJcbiAqICAgKTtcclxuICogfTtcclxuICogYGBgXHJcbiAqL1xuXG5mdW5jdGlvbiB1c2VJblZpZXcoe1xuICB0aHJlc2hvbGQsXG4gIGRlbGF5LFxuICB0cmFja1Zpc2liaWxpdHksXG4gIHJvb3RNYXJnaW4sXG4gIHJvb3QsXG4gIHRyaWdnZXJPbmNlLFxuICBza2lwLFxuICBpbml0aWFsSW5WaWV3LFxuICBmYWxsYmFja0luVmlldyxcbiAgb25DaGFuZ2Vcbn0gPSB7fSkge1xuICB2YXIgX3N0YXRlJGVudHJ5O1xuXG4gIGNvbnN0IFtyZWYsIHNldFJlZl0gPSBSZWFjdC51c2VTdGF0ZShudWxsKTtcbiAgY29uc3QgY2FsbGJhY2sgPSBSZWFjdC51c2VSZWYoKTtcbiAgY29uc3QgW3N0YXRlLCBzZXRTdGF0ZV0gPSBSZWFjdC51c2VTdGF0ZSh7XG4gICAgaW5WaWV3OiAhIWluaXRpYWxJblZpZXcsXG4gICAgZW50cnk6IHVuZGVmaW5lZFxuICB9KTsgLy8gU3RvcmUgdGhlIG9uQ2hhbmdlIGNhbGxiYWNrIGluIGEgYHJlZmAsIHNvIHdlIGNhbiBhY2Nlc3MgdGhlIGxhdGVzdCBpbnN0YW5jZVxuICAvLyBpbnNpZGUgdGhlIGB1c2VFZmZlY3RgLCBidXQgd2l0aG91dCB0cmlnZ2VyaW5nIGEgcmVyZW5kZXIuXG5cbiAgY2FsbGJhY2suY3VycmVudCA9IG9uQ2hhbmdlO1xuICBSZWFjdC51c2VFZmZlY3QoKCkgPT4ge1xuICAgIC8vIEVuc3VyZSB3ZSBoYXZlIG5vZGUgcmVmLCBhbmQgdGhhdCB3ZSBzaG91bGRuJ3Qgc2tpcCBvYnNlcnZpbmdcbiAgICBpZiAoc2tpcCB8fCAhcmVmKSByZXR1cm47XG4gICAgbGV0IHVub2JzZXJ2ZSA9IG9ic2VydmUocmVmLCAoaW5WaWV3LCBlbnRyeSkgPT4ge1xuICAgICAgc2V0U3RhdGUoe1xuICAgICAgICBpblZpZXcsXG4gICAgICAgIGVudHJ5XG4gICAgICB9KTtcbiAgICAgIGlmIChjYWxsYmFjay5jdXJyZW50KSBjYWxsYmFjay5jdXJyZW50KGluVmlldywgZW50cnkpO1xuXG4gICAgICBpZiAoZW50cnkuaXNJbnRlcnNlY3RpbmcgJiYgdHJpZ2dlck9uY2UgJiYgdW5vYnNlcnZlKSB7XG4gICAgICAgIC8vIElmIGl0IHNob3VsZCBvbmx5IHRyaWdnZXIgb25jZSwgdW5vYnNlcnZlIHRoZSBlbGVtZW50IGFmdGVyIGl0J3MgaW5WaWV3XG4gICAgICAgIHVub2JzZXJ2ZSgpO1xuICAgICAgICB1bm9ic2VydmUgPSB1bmRlZmluZWQ7XG4gICAgICB9XG4gICAgfSwge1xuICAgICAgcm9vdCxcbiAgICAgIHJvb3RNYXJnaW4sXG4gICAgICB0aHJlc2hvbGQsXG4gICAgICAvLyBAdHMtaWdub3JlXG4gICAgICB0cmFja1Zpc2liaWxpdHksXG4gICAgICAvLyBAdHMtaWdub3JlXG4gICAgICBkZWxheVxuICAgIH0sIGZhbGxiYWNrSW5WaWV3KTtcbiAgICByZXR1cm4gKCkgPT4ge1xuICAgICAgaWYgKHVub2JzZXJ2ZSkge1xuICAgICAgICB1bm9ic2VydmUoKTtcbiAgICAgIH1cbiAgICB9O1xuICB9LCAvLyBXZSBicmVhayB0aGUgcnVsZSBoZXJlLCBiZWNhdXNlIHdlIGFyZW4ndCBpbmNsdWRpbmcgdGhlIGFjdHVhbCBgdGhyZXNob2xkYCB2YXJpYWJsZVxuICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgcmVhY3QtaG9va3MvZXhoYXVzdGl2ZS1kZXBzXG4gIFsvLyBJZiB0aGUgdGhyZXNob2xkIGlzIGFuIGFycmF5LCBjb252ZXJ0IGl0IHRvIGEgc3RyaW5nLCBzbyBpdCB3b24ndCBjaGFuZ2UgYmV0d2VlbiByZW5kZXJzLlxuICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgcmVhY3QtaG9va3MvZXhoYXVzdGl2ZS1kZXBzXG4gIEFycmF5LmlzQXJyYXkodGhyZXNob2xkKSA/IHRocmVzaG9sZC50b1N0cmluZygpIDogdGhyZXNob2xkLCByZWYsIHJvb3QsIHJvb3RNYXJnaW4sIHRyaWdnZXJPbmNlLCBza2lwLCB0cmFja1Zpc2liaWxpdHksIGZhbGxiYWNrSW5WaWV3LCBkZWxheV0pO1xuICBjb25zdCBlbnRyeVRhcmdldCA9IChfc3RhdGUkZW50cnkgPSBzdGF0ZS5lbnRyeSkgPT0gbnVsbCA/IHZvaWQgMCA6IF9zdGF0ZSRlbnRyeS50YXJnZXQ7XG4gIFJlYWN0LnVzZUVmZmVjdCgoKSA9PiB7XG4gICAgaWYgKCFyZWYgJiYgZW50cnlUYXJnZXQgJiYgIXRyaWdnZXJPbmNlICYmICFza2lwKSB7XG4gICAgICAvLyBJZiB3ZSBkb24ndCBoYXZlIGEgbm9kZSByZWYsIHRoZW4gcmVzZXQgdGhlIHN0YXRlICh1bmxlc3MgdGhlIGhvb2sgaXMgc2V0IHRvIG9ubHkgYHRyaWdnZXJPbmNlYCBvciBgc2tpcGApXG4gICAgICAvLyBUaGlzIGVuc3VyZXMgd2UgY29ycmVjdGx5IHJlZmxlY3QgdGhlIGN1cnJlbnQgc3RhdGUgLSBJZiB5b3UgYXJlbid0IG9ic2VydmluZyBhbnl0aGluZywgdGhlbiBub3RoaW5nIGlzIGluVmlld1xuICAgICAgc2V0U3RhdGUoe1xuICAgICAgICBpblZpZXc6ICEhaW5pdGlhbEluVmlldyxcbiAgICAgICAgZW50cnk6IHVuZGVmaW5lZFxuICAgICAgfSk7XG4gICAgfVxuICB9LCBbcmVmLCBlbnRyeVRhcmdldCwgdHJpZ2dlck9uY2UsIHNraXAsIGluaXRpYWxJblZpZXddKTtcbiAgY29uc3QgcmVzdWx0ID0gW3NldFJlZiwgc3RhdGUuaW5WaWV3LCBzdGF0ZS5lbnRyeV07IC8vIFN1cHBvcnQgb2JqZWN0IGRlc3RydWN0dXJpbmcsIGJ5IGFkZGluZyB0aGUgc3BlY2lmaWMgdmFsdWVzLlxuXG4gIHJlc3VsdC5yZWYgPSByZXN1bHRbMF07XG4gIHJlc3VsdC5pblZpZXcgPSByZXN1bHRbMV07XG4gIHJlc3VsdC5lbnRyeSA9IHJlc3VsdFsyXTtcbiAgcmV0dXJuIHJlc3VsdDtcbn1cblxuZXhwb3J0IHsgSW5WaWV3LCBkZWZhdWx0RmFsbGJhY2tJblZpZXcsIG9ic2VydmUsIHVzZUluVmlldyB9O1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9cmVhY3QtaW50ZXJzZWN0aW9uLW9ic2VydmVyLm1vZGVybi5tanMubWFwXG4iLCJpbXBvcnQgeyB1c2VFZmZlY3QsIHVzZUxheW91dEVmZmVjdCwgdXNlU3RhdGUsIHVzZVJlZiwgdXNlQ2FsbGJhY2sgfSBmcm9tICdyZWFjdCc7XG5pbXBvcnQgdXNlU1dSIGZyb20gJ3N3cic7XG5cbi8qISAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKlxyXG5Db3B5cmlnaHQgKGMpIE1pY3Jvc29mdCBDb3Jwb3JhdGlvbi5cclxuXHJcblBlcm1pc3Npb24gdG8gdXNlLCBjb3B5LCBtb2RpZnksIGFuZC9vciBkaXN0cmlidXRlIHRoaXMgc29mdHdhcmUgZm9yIGFueVxyXG5wdXJwb3NlIHdpdGggb3Igd2l0aG91dCBmZWUgaXMgaGVyZWJ5IGdyYW50ZWQuXHJcblxyXG5USEUgU09GVFdBUkUgSVMgUFJPVklERUQgXCJBUyBJU1wiIEFORCBUSEUgQVVUSE9SIERJU0NMQUlNUyBBTEwgV0FSUkFOVElFUyBXSVRIXHJcblJFR0FSRCBUTyBUSElTIFNPRlRXQVJFIElOQ0xVRElORyBBTEwgSU1QTElFRCBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWVxyXG5BTkQgRklUTkVTUy4gSU4gTk8gRVZFTlQgU0hBTEwgVEhFIEFVVEhPUiBCRSBMSUFCTEUgRk9SIEFOWSBTUEVDSUFMLCBESVJFQ1QsXHJcbklORElSRUNULCBPUiBDT05TRVFVRU5USUFMIERBTUFHRVMgT1IgQU5ZIERBTUFHRVMgV0hBVFNPRVZFUiBSRVNVTFRJTkcgRlJPTVxyXG5MT1NTIE9GIFVTRSwgREFUQSBPUiBQUk9GSVRTLCBXSEVUSEVSIElOIEFOIEFDVElPTiBPRiBDT05UUkFDVCwgTkVHTElHRU5DRSBPUlxyXG5PVEhFUiBUT1JUSU9VUyBBQ1RJT04sIEFSSVNJTkcgT1VUIE9GIE9SIElOIENPTk5FQ1RJT04gV0lUSCBUSEUgVVNFIE9SXHJcblBFUkZPUk1BTkNFIE9GIFRISVMgU09GVFdBUkUuXHJcbioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqICovXHJcblxyXG52YXIgX19hc3NpZ24gPSBmdW5jdGlvbigpIHtcclxuICAgIF9fYXNzaWduID0gT2JqZWN0LmFzc2lnbiB8fCBmdW5jdGlvbiBfX2Fzc2lnbih0KSB7XHJcbiAgICAgICAgZm9yICh2YXIgcywgaSA9IDEsIG4gPSBhcmd1bWVudHMubGVuZ3RoOyBpIDwgbjsgaSsrKSB7XHJcbiAgICAgICAgICAgIHMgPSBhcmd1bWVudHNbaV07XHJcbiAgICAgICAgICAgIGZvciAodmFyIHAgaW4gcykgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChzLCBwKSkgdFtwXSA9IHNbcF07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiB0O1xyXG4gICAgfTtcclxuICAgIHJldHVybiBfX2Fzc2lnbi5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xyXG59O1xyXG5cclxuZnVuY3Rpb24gX19hd2FpdGVyKHRoaXNBcmcsIF9hcmd1bWVudHMsIFAsIGdlbmVyYXRvcikge1xyXG4gICAgZnVuY3Rpb24gYWRvcHQodmFsdWUpIHsgcmV0dXJuIHZhbHVlIGluc3RhbmNlb2YgUCA/IHZhbHVlIDogbmV3IFAoZnVuY3Rpb24gKHJlc29sdmUpIHsgcmVzb2x2ZSh2YWx1ZSk7IH0pOyB9XHJcbiAgICByZXR1cm4gbmV3IChQIHx8IChQID0gUHJvbWlzZSkpKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICBmdW5jdGlvbiBmdWxmaWxsZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3IubmV4dCh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XHJcbiAgICAgICAgZnVuY3Rpb24gcmVqZWN0ZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3JbXCJ0aHJvd1wiXSh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XHJcbiAgICAgICAgZnVuY3Rpb24gc3RlcChyZXN1bHQpIHsgcmVzdWx0LmRvbmUgPyByZXNvbHZlKHJlc3VsdC52YWx1ZSkgOiBhZG9wdChyZXN1bHQudmFsdWUpLnRoZW4oZnVsZmlsbGVkLCByZWplY3RlZCk7IH1cclxuICAgICAgICBzdGVwKChnZW5lcmF0b3IgPSBnZW5lcmF0b3IuYXBwbHkodGhpc0FyZywgX2FyZ3VtZW50cyB8fCBbXSkpLm5leHQoKSk7XHJcbiAgICB9KTtcclxufVxyXG5cclxuZnVuY3Rpb24gX19nZW5lcmF0b3IodGhpc0FyZywgYm9keSkge1xyXG4gICAgdmFyIF8gPSB7IGxhYmVsOiAwLCBzZW50OiBmdW5jdGlvbigpIHsgaWYgKHRbMF0gJiAxKSB0aHJvdyB0WzFdOyByZXR1cm4gdFsxXTsgfSwgdHJ5czogW10sIG9wczogW10gfSwgZiwgeSwgdCwgZztcclxuICAgIHJldHVybiBnID0geyBuZXh0OiB2ZXJiKDApLCBcInRocm93XCI6IHZlcmIoMSksIFwicmV0dXJuXCI6IHZlcmIoMikgfSwgdHlwZW9mIFN5bWJvbCA9PT0gXCJmdW5jdGlvblwiICYmIChnW1N5bWJvbC5pdGVyYXRvcl0gPSBmdW5jdGlvbigpIHsgcmV0dXJuIHRoaXM7IH0pLCBnO1xyXG4gICAgZnVuY3Rpb24gdmVyYihuKSB7IHJldHVybiBmdW5jdGlvbiAodikgeyByZXR1cm4gc3RlcChbbiwgdl0pOyB9OyB9XHJcbiAgICBmdW5jdGlvbiBzdGVwKG9wKSB7XHJcbiAgICAgICAgaWYgKGYpIHRocm93IG5ldyBUeXBlRXJyb3IoXCJHZW5lcmF0b3IgaXMgYWxyZWFkeSBleGVjdXRpbmcuXCIpO1xyXG4gICAgICAgIHdoaWxlIChfKSB0cnkge1xyXG4gICAgICAgICAgICBpZiAoZiA9IDEsIHkgJiYgKHQgPSBvcFswXSAmIDIgPyB5W1wicmV0dXJuXCJdIDogb3BbMF0gPyB5W1widGhyb3dcIl0gfHwgKCh0ID0geVtcInJldHVyblwiXSkgJiYgdC5jYWxsKHkpLCAwKSA6IHkubmV4dCkgJiYgISh0ID0gdC5jYWxsKHksIG9wWzFdKSkuZG9uZSkgcmV0dXJuIHQ7XHJcbiAgICAgICAgICAgIGlmICh5ID0gMCwgdCkgb3AgPSBbb3BbMF0gJiAyLCB0LnZhbHVlXTtcclxuICAgICAgICAgICAgc3dpdGNoIChvcFswXSkge1xyXG4gICAgICAgICAgICAgICAgY2FzZSAwOiBjYXNlIDE6IHQgPSBvcDsgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICBjYXNlIDQ6IF8ubGFiZWwrKzsgcmV0dXJuIHsgdmFsdWU6IG9wWzFdLCBkb25lOiBmYWxzZSB9O1xyXG4gICAgICAgICAgICAgICAgY2FzZSA1OiBfLmxhYmVsKys7IHkgPSBvcFsxXTsgb3AgPSBbMF07IGNvbnRpbnVlO1xyXG4gICAgICAgICAgICAgICAgY2FzZSA3OiBvcCA9IF8ub3BzLnBvcCgpOyBfLnRyeXMucG9wKCk7IGNvbnRpbnVlO1xyXG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgICAgICBpZiAoISh0ID0gXy50cnlzLCB0ID0gdC5sZW5ndGggPiAwICYmIHRbdC5sZW5ndGggLSAxXSkgJiYgKG9wWzBdID09PSA2IHx8IG9wWzBdID09PSAyKSkgeyBfID0gMDsgY29udGludWU7IH1cclxuICAgICAgICAgICAgICAgICAgICBpZiAob3BbMF0gPT09IDMgJiYgKCF0IHx8IChvcFsxXSA+IHRbMF0gJiYgb3BbMV0gPCB0WzNdKSkpIHsgXy5sYWJlbCA9IG9wWzFdOyBicmVhazsgfVxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChvcFswXSA9PT0gNiAmJiBfLmxhYmVsIDwgdFsxXSkgeyBfLmxhYmVsID0gdFsxXTsgdCA9IG9wOyBicmVhazsgfVxyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0ICYmIF8ubGFiZWwgPCB0WzJdKSB7IF8ubGFiZWwgPSB0WzJdOyBfLm9wcy5wdXNoKG9wKTsgYnJlYWs7IH1cclxuICAgICAgICAgICAgICAgICAgICBpZiAodFsyXSkgXy5vcHMucG9wKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgXy50cnlzLnBvcCgpOyBjb250aW51ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBvcCA9IGJvZHkuY2FsbCh0aGlzQXJnLCBfKTtcclxuICAgICAgICB9IGNhdGNoIChlKSB7IG9wID0gWzYsIGVdOyB5ID0gMDsgfSBmaW5hbGx5IHsgZiA9IHQgPSAwOyB9XHJcbiAgICAgICAgaWYgKG9wWzBdICYgNSkgdGhyb3cgb3BbMV07IHJldHVybiB7IHZhbHVlOiBvcFswXSA/IG9wWzFdIDogdm9pZCAwLCBkb25lOiB0cnVlIH07XHJcbiAgICB9XHJcbn1cblxudmFyIG5vb3AgPSBmdW5jdGlvbiAoKSB7IH07XG4vLyBVc2luZyBub29wKCkgYXMgdGhlIHVuZGVmaW5lZCB2YWx1ZSBhcyB1bmRlZmluZWQgY2FuIHBvc3NpYmx5IGJlIHJlcGxhY2VkXG4vLyBieSBzb21ldGhpbmcgZWxzZS4gIFByZXR0aWVyIGlnbm9yZSBhbmQgZXh0cmEgcGFyZW50aGVzZXMgYXJlIG5lY2Vzc2FyeSBoZXJlXG4vLyB0byBlbnN1cmUgdGhhdCB0c2MgZG9lc24ndCByZW1vdmUgdGhlIF9fTk9JTkxJTkVfXyBjb21tZW50LlxuLy8gcHJldHRpZXItaWdub3JlXG52YXIgVU5ERUZJTkVEID0gKCAvKiNfX05PSU5MSU5FX18qL25vb3AoKSk7XG52YXIgT0JKRUNUID0gT2JqZWN0O1xudmFyIGlzVW5kZWZpbmVkID0gZnVuY3Rpb24gKHYpIHsgcmV0dXJuIHYgPT09IFVOREVGSU5FRDsgfTtcbnZhciBpc0Z1bmN0aW9uID0gZnVuY3Rpb24gKHYpIHsgcmV0dXJuIHR5cGVvZiB2ID09ICdmdW5jdGlvbic7IH07XG52YXIgU1RSX1VOREVGSU5FRCA9ICd1bmRlZmluZWQnO1xuLy8gTk9URTogVXNlIGZ1bmN0aW9uIHRvIGd1YXJhbnRlZSBpdCdzIHJlLWV2YWx1YXRlZCBiZXR3ZWVuIGpzZG9tIGFuZCBub2RlIHJ1bnRpbWUgZm9yIHRlc3RzLlxudmFyIGhhc1dpbmRvdyA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHR5cGVvZiB3aW5kb3cgIT0gU1RSX1VOREVGSU5FRDsgfTtcblxudmFyIElTX1NFUlZFUiA9ICFoYXNXaW5kb3coKSB8fCAnRGVubycgaW4gd2luZG93O1xuLy8gUmVhY3QgY3VycmVudGx5IHRocm93cyBhIHdhcm5pbmcgd2hlbiB1c2luZyB1c2VMYXlvdXRFZmZlY3Qgb24gdGhlIHNlcnZlci5cbi8vIFRvIGdldCBhcm91bmQgaXQsIHdlIGNhbiBjb25kaXRpb25hbGx5IHVzZUVmZmVjdCBvbiB0aGUgc2VydmVyIChuby1vcCkgYW5kXG4vLyB1c2VMYXlvdXRFZmZlY3QgaW4gdGhlIGJyb3dzZXIuXG52YXIgdXNlSXNvbW9ycGhpY0xheW91dEVmZmVjdCA9IElTX1NFUlZFUiA/IHVzZUVmZmVjdCA6IHVzZUxheW91dEVmZmVjdDtcblxuLy8gdXNlIFdlYWtNYXAgdG8gc3RvcmUgdGhlIG9iamVjdC0+a2V5IG1hcHBpbmdcbi8vIHNvIHRoZSBvYmplY3RzIGNhbiBiZSBnYXJiYWdlIGNvbGxlY3RlZC5cbi8vIFdlYWtNYXAgdXNlcyBhIGhhc2h0YWJsZSB1bmRlciB0aGUgaG9vZCwgc28gdGhlIGxvb2t1cFxuLy8gY29tcGxleGl0eSBpcyBhbG1vc3QgTygxKS5cbnZhciB0YWJsZSA9IG5ldyBXZWFrTWFwKCk7XG4vLyBjb3VudGVyIG9mIHRoZSBrZXlcbnZhciBjb3VudGVyID0gMDtcbi8vIEEgc3RhYmxlIGhhc2ggaW1wbGVtZW50YXRpb24gdGhhdCBzdXBwb3J0czpcbi8vIC0gRmFzdCBhbmQgZW5zdXJlcyB1bmlxdWUgaGFzaCBwcm9wZXJ0aWVzXG4vLyAtIEhhbmRsZXMgdW5zZXJpYWxpemFibGUgdmFsdWVzXG4vLyAtIEhhbmRsZXMgb2JqZWN0IGtleSBvcmRlcmluZ1xuLy8gLSBHZW5lcmF0ZXMgc2hvcnQgcmVzdWx0c1xuLy9cbi8vIFRoaXMgaXMgbm90IGEgc2VyaWFsaXphdGlvbiBmdW5jdGlvbiwgYW5kIHRoZSByZXN1bHQgaXMgbm90IGd1YXJhbnRlZWQgdG8gYmVcbi8vIHBhcnNpYmxlLlxudmFyIHN0YWJsZUhhc2ggPSBmdW5jdGlvbiAoYXJnKSB7XG4gICAgdmFyIHR5cGUgPSB0eXBlb2YgYXJnO1xuICAgIHZhciBjb25zdHJ1Y3RvciA9IGFyZyAmJiBhcmcuY29uc3RydWN0b3I7XG4gICAgdmFyIGlzRGF0ZSA9IGNvbnN0cnVjdG9yID09IERhdGU7XG4gICAgdmFyIHJlc3VsdDtcbiAgICB2YXIgaW5kZXg7XG4gICAgaWYgKE9CSkVDVChhcmcpID09PSBhcmcgJiYgIWlzRGF0ZSAmJiBjb25zdHJ1Y3RvciAhPSBSZWdFeHApIHtcbiAgICAgICAgLy8gT2JqZWN0L2Z1bmN0aW9uLCBub3QgbnVsbC9kYXRlL3JlZ2V4cC4gVXNlIFdlYWtNYXAgdG8gc3RvcmUgdGhlIGlkIGZpcnN0LlxuICAgICAgICAvLyBJZiBpdCdzIGFscmVhZHkgaGFzaGVkLCBkaXJlY3RseSByZXR1cm4gdGhlIHJlc3VsdC5cbiAgICAgICAgcmVzdWx0ID0gdGFibGUuZ2V0KGFyZyk7XG4gICAgICAgIGlmIChyZXN1bHQpXG4gICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgICAgICAvLyBTdG9yZSB0aGUgaGFzaCBmaXJzdCBmb3IgY2lyY3VsYXIgcmVmZXJlbmNlIGRldGVjdGlvbiBiZWZvcmUgZW50ZXJpbmcgdGhlXG4gICAgICAgIC8vIHJlY3Vyc2l2ZSBgc3RhYmxlSGFzaGAgY2FsbHMuXG4gICAgICAgIC8vIEZvciBvdGhlciBvYmplY3RzIGxpa2Ugc2V0IGFuZCBtYXAsIHdlIHVzZSB0aGlzIGlkIGRpcmVjdGx5IGFzIHRoZSBoYXNoLlxuICAgICAgICByZXN1bHQgPSArK2NvdW50ZXIgKyAnfic7XG4gICAgICAgIHRhYmxlLnNldChhcmcsIHJlc3VsdCk7XG4gICAgICAgIGlmIChjb25zdHJ1Y3RvciA9PSBBcnJheSkge1xuICAgICAgICAgICAgLy8gQXJyYXkuXG4gICAgICAgICAgICByZXN1bHQgPSAnQCc7XG4gICAgICAgICAgICBmb3IgKGluZGV4ID0gMDsgaW5kZXggPCBhcmcubGVuZ3RoOyBpbmRleCsrKSB7XG4gICAgICAgICAgICAgICAgcmVzdWx0ICs9IHN0YWJsZUhhc2goYXJnW2luZGV4XSkgKyAnLCc7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0YWJsZS5zZXQoYXJnLCByZXN1bHQpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChjb25zdHJ1Y3RvciA9PSBPQkpFQ1QpIHtcbiAgICAgICAgICAgIC8vIE9iamVjdCwgc29ydCBrZXlzLlxuICAgICAgICAgICAgcmVzdWx0ID0gJyMnO1xuICAgICAgICAgICAgdmFyIGtleXMgPSBPQkpFQ1Qua2V5cyhhcmcpLnNvcnQoKTtcbiAgICAgICAgICAgIHdoaWxlICghaXNVbmRlZmluZWQoKGluZGV4ID0ga2V5cy5wb3AoKSkpKSB7XG4gICAgICAgICAgICAgICAgaWYgKCFpc1VuZGVmaW5lZChhcmdbaW5kZXhdKSkge1xuICAgICAgICAgICAgICAgICAgICByZXN1bHQgKz0gaW5kZXggKyAnOicgKyBzdGFibGVIYXNoKGFyZ1tpbmRleF0pICsgJywnO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRhYmxlLnNldChhcmcsIHJlc3VsdCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIHJlc3VsdCA9IGlzRGF0ZVxuICAgICAgICAgICAgPyBhcmcudG9KU09OKClcbiAgICAgICAgICAgIDogdHlwZSA9PSAnc3ltYm9sJ1xuICAgICAgICAgICAgICAgID8gYXJnLnRvU3RyaW5nKClcbiAgICAgICAgICAgICAgICA6IHR5cGUgPT0gJ3N0cmluZydcbiAgICAgICAgICAgICAgICAgICAgPyBKU09OLnN0cmluZ2lmeShhcmcpXG4gICAgICAgICAgICAgICAgICAgIDogJycgKyBhcmc7XG4gICAgfVxuICAgIHJldHVybiByZXN1bHQ7XG59O1xuXG52YXIgc2VyaWFsaXplID0gZnVuY3Rpb24gKGtleSkge1xuICAgIGlmIChpc0Z1bmN0aW9uKGtleSkpIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGtleSA9IGtleSgpO1xuICAgICAgICB9XG4gICAgICAgIGNhdGNoIChlcnIpIHtcbiAgICAgICAgICAgIC8vIGRlcGVuZGVuY2llcyBub3QgcmVhZHlcbiAgICAgICAgICAgIGtleSA9ICcnO1xuICAgICAgICB9XG4gICAgfVxuICAgIHZhciBhcmdzID0gW10uY29uY2F0KGtleSk7XG4gICAgLy8gSWYga2V5IGlzIG5vdCBmYWxzeSwgb3Igbm90IGFuIGVtcHR5IGFycmF5LCBoYXNoIGl0LlxuICAgIGtleSA9XG4gICAgICAgIHR5cGVvZiBrZXkgPT0gJ3N0cmluZydcbiAgICAgICAgICAgID8ga2V5XG4gICAgICAgICAgICA6IChBcnJheS5pc0FycmF5KGtleSkgPyBrZXkubGVuZ3RoIDoga2V5KVxuICAgICAgICAgICAgICAgID8gc3RhYmxlSGFzaChrZXkpXG4gICAgICAgICAgICAgICAgOiAnJztcbiAgICB2YXIgaW5mb0tleSA9IGtleSA/ICckc3dyJCcgKyBrZXkgOiAnJztcbiAgICByZXR1cm4gW2tleSwgYXJncywgaW5mb0tleV07XG59O1xuXG52YXIgbm9ybWFsaXplID0gZnVuY3Rpb24gKGFyZ3MpIHtcbiAgICByZXR1cm4gaXNGdW5jdGlvbihhcmdzWzFdKVxuICAgICAgICA/IFthcmdzWzBdLCBhcmdzWzFdLCBhcmdzWzJdIHx8IHt9XVxuICAgICAgICA6IFthcmdzWzBdLCBudWxsLCAoYXJnc1sxXSA9PT0gbnVsbCA/IGFyZ3NbMl0gOiBhcmdzWzFdKSB8fCB7fV07XG59O1xuXG4vLyBDcmVhdGUgYSBjdXN0b20gaG9vayB3aXRoIGEgbWlkZGxld2FyZVxudmFyIHdpdGhNaWRkbGV3YXJlID0gZnVuY3Rpb24gKHVzZVNXUiwgbWlkZGxld2FyZSkge1xuICAgIHJldHVybiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBhcmdzID0gW107XG4gICAgICAgIGZvciAodmFyIF9pID0gMDsgX2kgPCBhcmd1bWVudHMubGVuZ3RoOyBfaSsrKSB7XG4gICAgICAgICAgICBhcmdzW19pXSA9IGFyZ3VtZW50c1tfaV07XG4gICAgICAgIH1cbiAgICAgICAgdmFyIF9hID0gbm9ybWFsaXplKGFyZ3MpLCBrZXkgPSBfYVswXSwgZm4gPSBfYVsxXSwgY29uZmlnID0gX2FbMl07XG4gICAgICAgIHZhciB1c2VzID0gKGNvbmZpZy51c2UgfHwgW10pLmNvbmNhdChtaWRkbGV3YXJlKTtcbiAgICAgICAgcmV0dXJuIHVzZVNXUihrZXksIGZuLCBfX2Fzc2lnbihfX2Fzc2lnbih7fSwgY29uZmlnKSwgeyB1c2U6IHVzZXMgfSkpO1xuICAgIH07XG59O1xuXG4vLyBXZSBoYXZlIHRvIHNldmVyYWwgdHlwZSBjYXN0aW5ncyBoZXJlIGJlY2F1c2UgYHVzZVNXUkluZmluaXRlYCBpcyBhIHNwZWNpYWxcbnZhciBJTkZJTklURV9QUkVGSVggPSAnJGluZiQnO1xudmFyIGdldEZpcnN0UGFnZUtleSA9IGZ1bmN0aW9uIChnZXRLZXkpIHtcbiAgICByZXR1cm4gc2VyaWFsaXplKGdldEtleSA/IGdldEtleSgwLCBudWxsKSA6IG51bGwpWzBdO1xufTtcbnZhciB1bnN0YWJsZV9zZXJpYWxpemUgPSBmdW5jdGlvbiAoZ2V0S2V5KSB7XG4gICAgcmV0dXJuIElORklOSVRFX1BSRUZJWCArIGdldEZpcnN0UGFnZUtleShnZXRLZXkpO1xufTtcbnZhciBpbmZpbml0ZSA9IChmdW5jdGlvbiAodXNlU1dSTmV4dCkge1xuICAgIHJldHVybiBmdW5jdGlvbiAoZ2V0S2V5LCBmbiwgY29uZmlnKSB7XG4gICAgICAgIHZhciByZXJlbmRlciA9IHVzZVN0YXRlKHt9KVsxXTtcbiAgICAgICAgdmFyIGRpZE1vdW50UmVmID0gdXNlUmVmKGZhbHNlKTtcbiAgICAgICAgdmFyIGRhdGFSZWYgPSB1c2VSZWYoKTtcbiAgICAgICAgdmFyIGNhY2hlID0gY29uZmlnLmNhY2hlLCBfYSA9IGNvbmZpZy5pbml0aWFsU2l6ZSwgaW5pdGlhbFNpemUgPSBfYSA9PT0gdm9pZCAwID8gMSA6IF9hLCBfYiA9IGNvbmZpZy5yZXZhbGlkYXRlQWxsLCByZXZhbGlkYXRlQWxsID0gX2IgPT09IHZvaWQgMCA/IGZhbHNlIDogX2IsIF9jID0gY29uZmlnLnBlcnNpc3RTaXplLCBwZXJzaXN0U2l6ZSA9IF9jID09PSB2b2lkIDAgPyBmYWxzZSA6IF9jLCBfZCA9IGNvbmZpZy5yZXZhbGlkYXRlRmlyc3RQYWdlLCByZXZhbGlkYXRlRmlyc3RQYWdlID0gX2QgPT09IHZvaWQgMCA/IHRydWUgOiBfZCwgX2UgPSBjb25maWcucmV2YWxpZGF0ZU9uTW91bnQsIHJldmFsaWRhdGVPbk1vdW50ID0gX2UgPT09IHZvaWQgMCA/IGZhbHNlIDogX2U7XG4gICAgICAgIC8vIFRoZSBzZXJpYWxpemVkIGtleSBvZiB0aGUgZmlyc3QgcGFnZS5cbiAgICAgICAgdmFyIGZpcnN0UGFnZUtleSA9IG51bGw7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBmaXJzdFBhZ2VLZXkgPSBnZXRGaXJzdFBhZ2VLZXkoZ2V0S2V5KTtcbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAoZXJyKSB7XG4gICAgICAgICAgICAvLyBub3QgcmVhZHlcbiAgICAgICAgfVxuICAgICAgICAvLyBXZSB1c2UgY2FjaGUgdG8gcGFzcyBleHRyYSBpbmZvIChjb250ZXh0KSB0byBmZXRjaGVyIHNvIGl0IGNhbiBiZSBnbG9iYWxseVxuICAgICAgICAvLyBzaGFyZWQuIFRoZSBrZXkgb2YgdGhlIGNvbnRleHQgZGF0YSBpcyBiYXNlZCBvbiB0aGUgZmlyc3QgcGFnZSBrZXkuXG4gICAgICAgIHZhciBjb250ZXh0Q2FjaGVLZXkgPSBudWxsO1xuICAgICAgICAvLyBQYWdlIHNpemUgaXMgYWxzbyBjYWNoZWQgdG8gc2hhcmUgdGhlIHBhZ2UgZGF0YSBiZXR3ZWVuIGhvb2tzIHdpdGggdGhlXG4gICAgICAgIC8vIHNhbWUga2V5LlxuICAgICAgICB2YXIgcGFnZVNpemVDYWNoZUtleSA9IG51bGw7XG4gICAgICAgIGlmIChmaXJzdFBhZ2VLZXkpIHtcbiAgICAgICAgICAgIGNvbnRleHRDYWNoZUtleSA9ICckY3R4JCcgKyBmaXJzdFBhZ2VLZXk7XG4gICAgICAgICAgICBwYWdlU2l6ZUNhY2hlS2V5ID0gJyRsZW4kJyArIGZpcnN0UGFnZUtleTtcbiAgICAgICAgfVxuICAgICAgICB2YXIgcmVzb2x2ZVBhZ2VTaXplID0gdXNlQ2FsbGJhY2soZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdmFyIGNhY2hlZFBhZ2VTaXplID0gY2FjaGUuZ2V0KHBhZ2VTaXplQ2FjaGVLZXkpO1xuICAgICAgICAgICAgcmV0dXJuIGlzVW5kZWZpbmVkKGNhY2hlZFBhZ2VTaXplKSA/IGluaXRpYWxTaXplIDogY2FjaGVkUGFnZVNpemU7XG4gICAgICAgICAgICAvLyBgY2FjaGVgIGlzbid0IGFsbG93ZWQgdG8gY2hhbmdlIGR1cmluZyB0aGUgbGlmZWN5Y2xlXG4gICAgICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgcmVhY3QtaG9va3MvZXhoYXVzdGl2ZS1kZXBzXG4gICAgICAgIH0sIFtwYWdlU2l6ZUNhY2hlS2V5LCBpbml0aWFsU2l6ZV0pO1xuICAgICAgICAvLyBrZWVwIHRoZSBsYXN0IHBhZ2Ugc2l6ZSB0byByZXN0b3JlIGl0IHdpdGggdGhlIHBlcnNpc3RTaXplIG9wdGlvblxuICAgICAgICB2YXIgbGFzdFBhZ2VTaXplUmVmID0gdXNlUmVmKHJlc29sdmVQYWdlU2l6ZSgpKTtcbiAgICAgICAgLy8gV2hlbiB0aGUgcGFnZSBrZXkgY2hhbmdlcywgd2UgcmVzZXQgdGhlIHBhZ2Ugc2l6ZSBpZiBpdCdzIG5vdCBwZXJzaXN0ZWRcbiAgICAgICAgdXNlSXNvbW9ycGhpY0xheW91dEVmZmVjdChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBpZiAoIWRpZE1vdW50UmVmLmN1cnJlbnQpIHtcbiAgICAgICAgICAgICAgICBkaWRNb3VudFJlZi5jdXJyZW50ID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoZmlyc3RQYWdlS2V5KSB7XG4gICAgICAgICAgICAgICAgLy8gSWYgdGhlIGtleSBoYXMgYmVlbiBjaGFuZ2VkLCB3ZSBrZWVwIHRoZSBjdXJyZW50IHBhZ2Ugc2l6ZSBpZiBwZXJzaXN0U2l6ZSBpcyBlbmFibGVkXG4gICAgICAgICAgICAgICAgY2FjaGUuc2V0KHBhZ2VTaXplQ2FjaGVLZXksIHBlcnNpc3RTaXplID8gbGFzdFBhZ2VTaXplUmVmLmN1cnJlbnQgOiBpbml0aWFsU2l6ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyBgaW5pdGlhbFNpemVgIGlzbid0IGFsbG93ZWQgdG8gY2hhbmdlIGR1cmluZyB0aGUgbGlmZWN5Y2xlXG4gICAgICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgcmVhY3QtaG9va3MvZXhoYXVzdGl2ZS1kZXBzXG4gICAgICAgIH0sIFtmaXJzdFBhZ2VLZXldKTtcbiAgICAgICAgLy8gTmVlZHMgdG8gY2hlY2sgZGlkTW91bnRSZWYgZHVyaW5nIG1vdW50aW5nLCBub3QgaW4gdGhlIGZldGNoZXJcbiAgICAgICAgdmFyIHNob3VsZFJldmFsaWRhdGVPbk1vdW50ID0gcmV2YWxpZGF0ZU9uTW91bnQgJiYgIWRpZE1vdW50UmVmLmN1cnJlbnQ7XG4gICAgICAgIC8vIEFjdHVhbCBTV1IgaG9vayB0byBsb2FkIGFsbCBwYWdlcyBpbiBvbmUgZmV0Y2hlci5cbiAgICAgICAgdmFyIHN3ciA9IHVzZVNXUk5leHQoZmlyc3RQYWdlS2V5ID8gSU5GSU5JVEVfUFJFRklYICsgZmlyc3RQYWdlS2V5IDogbnVsbCwgZnVuY3Rpb24gKCkgeyByZXR1cm4gX19hd2FpdGVyKHZvaWQgMCwgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZhciBfYSwgZm9yY2VSZXZhbGlkYXRlQWxsLCBvcmlnaW5hbERhdGEsIGRhdGEsIHBhZ2VTaXplLCBwcmV2aW91c1BhZ2VEYXRhLCBpLCBfYiwgcGFnZUtleSwgcGFnZUFyZ3MsIHBhZ2VEYXRhLCBzaG91bGRGZXRjaFBhZ2U7XG4gICAgICAgICAgICByZXR1cm4gX19nZW5lcmF0b3IodGhpcywgZnVuY3Rpb24gKF9jKSB7XG4gICAgICAgICAgICAgICAgc3dpdGNoIChfYy5sYWJlbCkge1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDA6XG4gICAgICAgICAgICAgICAgICAgICAgICBfYSA9IGNhY2hlLmdldChjb250ZXh0Q2FjaGVLZXkpIHx8IFtdLCBmb3JjZVJldmFsaWRhdGVBbGwgPSBfYVswXSwgb3JpZ2luYWxEYXRhID0gX2FbMV07XG4gICAgICAgICAgICAgICAgICAgICAgICBkYXRhID0gW107XG4gICAgICAgICAgICAgICAgICAgICAgICBwYWdlU2l6ZSA9IHJlc29sdmVQYWdlU2l6ZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcHJldmlvdXNQYWdlRGF0YSA9IG51bGw7XG4gICAgICAgICAgICAgICAgICAgICAgICBpID0gMDtcbiAgICAgICAgICAgICAgICAgICAgICAgIF9jLmxhYmVsID0gMTtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAxOlxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCEoaSA8IHBhZ2VTaXplKSkgcmV0dXJuIFszIC8qYnJlYWsqLywgNV07XG4gICAgICAgICAgICAgICAgICAgICAgICBfYiA9IHNlcmlhbGl6ZShnZXRLZXkoaSwgcHJldmlvdXNQYWdlRGF0YSkpLCBwYWdlS2V5ID0gX2JbMF0sIHBhZ2VBcmdzID0gX2JbMV07XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXBhZ2VLZXkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBgcGFnZUtleWAgaXMgZmFsc3ksIHN0b3AgZmV0Y2hpbmcgbmV3IHBhZ2VzLlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbMyAvKmJyZWFrKi8sIDVdO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgcGFnZURhdGEgPSBjYWNoZS5nZXQocGFnZUtleSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBzaG91bGRGZXRjaFBhZ2UgPSByZXZhbGlkYXRlQWxsIHx8XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yY2VSZXZhbGlkYXRlQWxsIHx8XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaXNVbmRlZmluZWQocGFnZURhdGEpIHx8XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgKHJldmFsaWRhdGVGaXJzdFBhZ2UgJiYgIWkgJiYgIWlzVW5kZWZpbmVkKGRhdGFSZWYuY3VycmVudCkpIHx8XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2hvdWxkUmV2YWxpZGF0ZU9uTW91bnQgfHxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAob3JpZ2luYWxEYXRhICYmXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICFpc1VuZGVmaW5lZChvcmlnaW5hbERhdGFbaV0pICYmXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICFjb25maWcuY29tcGFyZShvcmlnaW5hbERhdGFbaV0sIHBhZ2VEYXRhKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIShmbiAmJiBzaG91bGRGZXRjaFBhZ2UpKSByZXR1cm4gWzMgLypicmVhayovLCAzXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbNCAvKnlpZWxkKi8sIGZuLmFwcGx5KHZvaWQgMCwgcGFnZUFyZ3MpXTtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAyOlxuICAgICAgICAgICAgICAgICAgICAgICAgcGFnZURhdGEgPSBfYy5zZW50KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYWNoZS5zZXQocGFnZUtleSwgcGFnZURhdGEpO1xuICAgICAgICAgICAgICAgICAgICAgICAgX2MubGFiZWwgPSAzO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDM6XG4gICAgICAgICAgICAgICAgICAgICAgICBkYXRhLnB1c2gocGFnZURhdGEpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcHJldmlvdXNQYWdlRGF0YSA9IHBhZ2VEYXRhO1xuICAgICAgICAgICAgICAgICAgICAgICAgX2MubGFiZWwgPSA0O1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDQ6XG4gICAgICAgICAgICAgICAgICAgICAgICArK2k7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzMgLypicmVhayovLCAxXTtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSA1OlxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gb25jZSB3ZSBleGVjdXRlZCB0aGUgZGF0YSBmZXRjaGluZyBiYXNlZCBvbiB0aGUgY29udGV4dCwgY2xlYXIgdGhlIGNvbnRleHRcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhY2hlLmRlbGV0ZShjb250ZXh0Q2FjaGVLZXkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gcmV0dXJuIHRoZSBkYXRhXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzIgLypyZXR1cm4qLywgZGF0YV07XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pOyB9LCBjb25maWcpO1xuICAgICAgICAvLyB1cGRhdGUgZGF0YVJlZlxuICAgICAgICB1c2VJc29tb3JwaGljTGF5b3V0RWZmZWN0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGRhdGFSZWYuY3VycmVudCA9IHN3ci5kYXRhO1xuICAgICAgICB9LCBbc3dyLmRhdGFdKTtcbiAgICAgICAgdmFyIG11dGF0ZSA9IHVzZUNhbGxiYWNrKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZhciBhcmdzID0gW107XG4gICAgICAgICAgICBmb3IgKHZhciBfaSA9IDA7IF9pIDwgYXJndW1lbnRzLmxlbmd0aDsgX2krKykge1xuICAgICAgICAgICAgICAgIGFyZ3NbX2ldID0gYXJndW1lbnRzW19pXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHZhciBkYXRhID0gYXJnc1swXTtcbiAgICAgICAgICAgIC8vIERlZmF1bHQgdG8gdHJ1ZS5cbiAgICAgICAgICAgIHZhciBzaG91bGRSZXZhbGlkYXRlID0gYXJnc1sxXSAhPT0gZmFsc2U7XG4gICAgICAgICAgICAvLyBJdCBpcyBwb3NzaWJsZSB0aGF0IHRoZSBrZXkgaXMgc3RpbGwgZmFsc3kuXG4gICAgICAgICAgICBpZiAoIWNvbnRleHRDYWNoZUtleSlcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICBpZiAoc2hvdWxkUmV2YWxpZGF0ZSkge1xuICAgICAgICAgICAgICAgIGlmICghaXNVbmRlZmluZWQoZGF0YSkpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gV2Ugb25seSByZXZhbGlkYXRlIHRoZSBwYWdlcyB0aGF0IGFyZSBjaGFuZ2VkXG4gICAgICAgICAgICAgICAgICAgIHZhciBvcmlnaW5hbERhdGEgPSBkYXRhUmVmLmN1cnJlbnQ7XG4gICAgICAgICAgICAgICAgICAgIGNhY2hlLnNldChjb250ZXh0Q2FjaGVLZXksIFtmYWxzZSwgb3JpZ2luYWxEYXRhXSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAvLyBDYWxsaW5nIGBtdXRhdGUoKWAsIHdlIHJldmFsaWRhdGUgYWxsIHBhZ2VzXG4gICAgICAgICAgICAgICAgICAgIGNhY2hlLnNldChjb250ZXh0Q2FjaGVLZXksIFt0cnVlXSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIGFyZ3MubGVuZ3RoID8gc3dyLm11dGF0ZShkYXRhLCBzaG91bGRSZXZhbGlkYXRlKSA6IHN3ci5tdXRhdGUoKTtcbiAgICAgICAgfSwgXG4gICAgICAgIC8vIHN3ci5tdXRhdGUgaXMgYWx3YXlzIHRoZSBzYW1lIHJlZmVyZW5jZVxuICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgcmVhY3QtaG9va3MvZXhoYXVzdGl2ZS1kZXBzXG4gICAgICAgIFtjb250ZXh0Q2FjaGVLZXldKTtcbiAgICAgICAgLy8gRnVuY3Rpb24gdG8gbG9hZCBwYWdlcyBkYXRhIGZyb20gdGhlIGNhY2hlIGJhc2VkIG9uIHRoZSBwYWdlIHNpemUuXG4gICAgICAgIHZhciByZXNvbHZlUGFnZXNGcm9tQ2FjaGUgPSBmdW5jdGlvbiAocGFnZVNpemUpIHtcbiAgICAgICAgICAgIC8vIHJldHVybiBhbiBhcnJheSBvZiBwYWdlIGRhdGFcbiAgICAgICAgICAgIHZhciBkYXRhID0gW107XG4gICAgICAgICAgICB2YXIgcHJldmlvdXNQYWdlRGF0YSA9IG51bGw7XG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHBhZ2VTaXplOyArK2kpIHtcbiAgICAgICAgICAgICAgICB2YXIgcGFnZUtleSA9IHNlcmlhbGl6ZShnZXRLZXkoaSwgcHJldmlvdXNQYWdlRGF0YSkpWzBdO1xuICAgICAgICAgICAgICAgIC8vIEdldCB0aGUgY2FjaGVkIHBhZ2UgZGF0YS5cbiAgICAgICAgICAgICAgICB2YXIgcGFnZURhdGEgPSBwYWdlS2V5ID8gY2FjaGUuZ2V0KHBhZ2VLZXkpIDogVU5ERUZJTkVEO1xuICAgICAgICAgICAgICAgIC8vIFJldHVybiB0aGUgY3VycmVudCBkYXRhIGlmIHdlIGNhbid0IGdldCBpdCBmcm9tIHRoZSBjYWNoZS5cbiAgICAgICAgICAgICAgICBpZiAoaXNVbmRlZmluZWQocGFnZURhdGEpKVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZGF0YVJlZi5jdXJyZW50O1xuICAgICAgICAgICAgICAgIGRhdGEucHVzaChwYWdlRGF0YSk7XG4gICAgICAgICAgICAgICAgcHJldmlvdXNQYWdlRGF0YSA9IHBhZ2VEYXRhO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gUmV0dXJuIHRoZSBkYXRhXG4gICAgICAgICAgICByZXR1cm4gZGF0YTtcbiAgICAgICAgfTtcbiAgICAgICAgLy8gRXh0ZW5kIHRoZSBTV1IgQVBJXG4gICAgICAgIHZhciBzZXRTaXplID0gdXNlQ2FsbGJhY2soZnVuY3Rpb24gKGFyZykge1xuICAgICAgICAgICAgLy8gSXQgaXMgcG9zc2libGUgdGhhdCB0aGUga2V5IGlzIHN0aWxsIGZhbHN5LlxuICAgICAgICAgICAgaWYgKCFwYWdlU2l6ZUNhY2hlS2V5KVxuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIHZhciBzaXplO1xuICAgICAgICAgICAgaWYgKGlzRnVuY3Rpb24oYXJnKSkge1xuICAgICAgICAgICAgICAgIHNpemUgPSBhcmcocmVzb2x2ZVBhZ2VTaXplKCkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAodHlwZW9mIGFyZyA9PSAnbnVtYmVyJykge1xuICAgICAgICAgICAgICAgIHNpemUgPSBhcmc7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAodHlwZW9mIHNpemUgIT0gJ251bWJlcicpXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgY2FjaGUuc2V0KHBhZ2VTaXplQ2FjaGVLZXksIHNpemUpO1xuICAgICAgICAgICAgbGFzdFBhZ2VTaXplUmVmLmN1cnJlbnQgPSBzaXplO1xuICAgICAgICAgICAgcmVyZW5kZXIoe30pO1xuICAgICAgICAgICAgcmV0dXJuIG11dGF0ZShyZXNvbHZlUGFnZXNGcm9tQ2FjaGUoc2l6ZSkpO1xuICAgICAgICB9LCBcbiAgICAgICAgLy8gYGNhY2hlYCBhbmQgYHJlcmVuZGVyYCBpc24ndCBhbGxvd2VkIHRvIGNoYW5nZSBkdXJpbmcgdGhlIGxpZmVjeWNsZVxuICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgcmVhY3QtaG9va3MvZXhoYXVzdGl2ZS1kZXBzXG4gICAgICAgIFtwYWdlU2l6ZUNhY2hlS2V5LCByZXNvbHZlUGFnZVNpemUsIG11dGF0ZV0pO1xuICAgICAgICAvLyBVc2UgZ2V0dGVyIGZ1bmN0aW9ucyB0byBhdm9pZCB1bm5lY2Vzc2FyeSByZS1yZW5kZXJzIGNhdXNlZCBieSB0cmlnZ2VyaW5nXG4gICAgICAgIC8vIGFsbCB0aGUgZ2V0dGVycyBvZiB0aGUgcmV0dXJuZWQgc3dyIG9iamVjdC5cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHNpemU6IHJlc29sdmVQYWdlU2l6ZSgpLFxuICAgICAgICAgICAgc2V0U2l6ZTogc2V0U2l6ZSxcbiAgICAgICAgICAgIG11dGF0ZTogbXV0YXRlLFxuICAgICAgICAgICAgZ2V0IGVycm9yKCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBzd3IuZXJyb3I7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0IGRhdGEoKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHN3ci5kYXRhO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdldCBpc1ZhbGlkYXRpbmcoKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHN3ci5pc1ZhbGlkYXRpbmc7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgfTtcbn0pO1xudmFyIGluZGV4ID0gd2l0aE1pZGRsZXdhcmUodXNlU1dSLCBpbmZpbml0ZSk7XG5cbmV4cG9ydCB7IGluZGV4IGFzIGRlZmF1bHQsIGluZmluaXRlLCB1bnN0YWJsZV9zZXJpYWxpemUgfTtcbiJdLCJuYW1lcyI6WyJvYnNlcnZlck1hcCIsIk1hcCIsIlJvb3RJZHMiLCJXZWFrTWFwIiwicm9vdElkIiwib2JzZXJ2ZSIsImVsZW1lbnQiLCJjYWxsYmFjayIsIm9wdGlvbnMiLCJmYWxsYmFja0luVmlldyIsIndpbmRvdyIsIkludGVyc2VjdGlvbk9ic2VydmVyIiwidW5kZWZpbmVkIiwiYm91bmRzIiwiZ2V0Qm91bmRpbmdDbGllbnRSZWN0IiwiaXNJbnRlcnNlY3RpbmciLCJ0YXJnZXQiLCJpbnRlcnNlY3Rpb25SYXRpbyIsInRocmVzaG9sZCIsInRpbWUiLCJib3VuZGluZ0NsaWVudFJlY3QiLCJpbnRlcnNlY3Rpb25SZWN0Iiwicm9vdEJvdW5kcyIsImlkIiwib2JzZXJ2ZXIiLCJlbGVtZW50cyIsIk9iamVjdCIsImtleXMiLCJzb3J0IiwiZmlsdGVyIiwia2V5IiwibWFwIiwicm9vdCIsImhhcyIsInNldCIsInRvU3RyaW5nIiwiZ2V0Iiwib3B0aW9uc1RvSWQiLCJpbnN0YW5jZSIsInRocmVzaG9sZHMiLCJlbnRyaWVzIiwiZm9yRWFjaCIsImVudHJ5IiwiX2VsZW1lbnRzJGdldCIsImluVmlldyIsInNvbWUiLCJ0cmFja1Zpc2liaWxpdHkiLCJpc1Zpc2libGUiLCJBcnJheSIsImlzQXJyYXkiLCJjcmVhdGVPYnNlcnZlciIsImNhbGxiYWNrcyIsInB1c2giLCJzcGxpY2UiLCJpbmRleE9mIiwibGVuZ3RoIiwiZGVsZXRlIiwidW5vYnNlcnZlIiwic2l6ZSIsImRpc2Nvbm5lY3QiLCJ1c2VJblZpZXciLCJkZWxheSIsInJvb3RNYXJnaW4iLCJ0cmlnZ2VyT25jZSIsInNraXAiLCJpbml0aWFsSW5WaWV3Iiwib25DaGFuZ2UiLCJfc3RhdGUkZW50cnkiLCJyZWYiLCJzZXRSZWYiLCJzdGF0ZSIsInNldFN0YXRlIiwiY3VycmVudCIsImVudHJ5VGFyZ2V0IiwicmVzdWx0IiwiX19hc3NpZ24iLCJhc3NpZ24iLCJ0IiwicyIsImkiLCJuIiwiYXJndW1lbnRzIiwicCIsInByb3RvdHlwZSIsImhhc093blByb3BlcnR5IiwiY2FsbCIsImFwcGx5IiwidGhpcyIsInVzZVNXUiIsIm1pZGRsZXdhcmUiLCJub29wIiwiVU5ERUZJTkVEIiwiT0JKRUNUIiwiaXNVbmRlZmluZWQiLCJ2IiwiaXNGdW5jdGlvbiIsInVzZUlzb21vcnBoaWNMYXlvdXRFZmZlY3QiLCJ1c2VFZmZlY3QiLCJ1c2VMYXlvdXRFZmZlY3QiLCJ0YWJsZSIsImNvdW50ZXIiLCJzdGFibGVIYXNoIiwiYXJnIiwiaW5kZXgiLCJ0eXBlIiwiY29uc3RydWN0b3IiLCJpc0RhdGUiLCJEYXRlIiwiUmVnRXhwIiwidG9KU09OIiwiSlNPTiIsInN0cmluZ2lmeSIsInBvcCIsInNlcmlhbGl6ZSIsImVyciIsImFyZ3MiLCJjb25jYXQiLCJub3JtYWxpemUiLCJ1c2VTV1JOZXh0IiwiZ2V0S2V5IiwiZm4iLCJjb25maWciLCJyZXJlbmRlciIsInVzZVN0YXRlIiwiZGlkTW91bnRSZWYiLCJ1c2VSZWYiLCJkYXRhUmVmIiwiY2FjaGUiLCJfYSIsImluaXRpYWxTaXplIiwiX2IiLCJyZXZhbGlkYXRlQWxsIiwiX2MiLCJwZXJzaXN0U2l6ZSIsIl9kIiwicmV2YWxpZGF0ZUZpcnN0UGFnZSIsIl9lIiwicmV2YWxpZGF0ZU9uTW91bnQiLCJmaXJzdFBhZ2VLZXkiLCJnZXRGaXJzdFBhZ2VLZXkiLCJjb250ZXh0Q2FjaGVLZXkiLCJwYWdlU2l6ZUNhY2hlS2V5IiwicmVzb2x2ZVBhZ2VTaXplIiwidXNlQ2FsbGJhY2siLCJjYWNoZWRQYWdlU2l6ZSIsImxhc3RQYWdlU2l6ZVJlZiIsInNob3VsZFJldmFsaWRhdGVPbk1vdW50Iiwic3dyIiwidGhpc0FyZyIsIl9hcmd1bWVudHMiLCJnZW5lcmF0b3IiLCJmb3JjZVJldmFsaWRhdGVBbGwiLCJvcmlnaW5hbERhdGEiLCJkYXRhIiwicGFnZVNpemUiLCJwcmV2aW91c1BhZ2VEYXRhIiwicGFnZUtleSIsInBhZ2VBcmdzIiwicGFnZURhdGEiLCJzaG91bGRGZXRjaFBhZ2UiLCJib2R5IiwiZiIsInkiLCJnIiwiXyIsImxhYmVsIiwic2VudCIsInRyeXMiLCJvcHMiLCJuZXh0IiwidmVyYiIsIlN5bWJvbCIsIml0ZXJhdG9yIiwib3AiLCJUeXBlRXJyb3IiLCJkb25lIiwidmFsdWUiLCJlIiwic3RlcCIsIl9fZ2VuZXJhdG9yIiwiY29tcGFyZSIsIlAiLCJQcm9taXNlIiwicmVzb2x2ZSIsInJlamVjdCIsImZ1bGZpbGxlZCIsInJlamVjdGVkIiwidGhlbiIsIm11dGF0ZSIsIl9pIiwic2hvdWxkUmV2YWxpZGF0ZSIsInNldFNpemUiLCJyZXNvbHZlUGFnZXNGcm9tQ2FjaGUiLCJlcnJvciIsImlzVmFsaWRhdGluZyIsInVzZXMiLCJ1c2UiXSwic291cmNlUm9vdCI6IiJ9